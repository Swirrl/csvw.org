var ot=(t,e)=>t!=null&&typeof t[e]=="function",Zn=t=>t!=null&&typeof t!="function"&&t.length!==void 0,me=t=>t!=null&&typeof t[Symbol.iterator]=="function",ge=(t,e=n=>n!==void 0?": "+n:"")=>class extends Error{constructor(n){super(t(n)+e(n))}},Oo=ge(()=>"illegal arity"),Qn=t=>{throw new Oo(t)},So=ge(()=>"unsupported operation"),gn=t=>{throw new So(t)},Yn=Symbol(),_e=()=>{},yn=t=>ot(t,"xform")?t.xform():t,ye=class{constructor(e){this.value=e}deref(){return this.value}},No=t=>new ye(t),gt=t=>t instanceof ye,wn=t=>t instanceof ye?t:new ye(t),Qt=t=>t instanceof ye?t.deref():t,To=t=>t.length===2?[void 0,t[1]]:t.length===3?[t[1],t[2]]:Qn(t.length);function Jn(...t){let e=t[0],n=e[0],s=e[1],r=e[2];t=To(t);let i=t[0]==null?n():t[0],o=t[1];return Qt(s(ot(o,"$reduce")?o.$reduce(r,i):Zn(o)?Eo(r,i,o):jo(r,i,o)))}var Eo=(t,e,n)=>{for(let s=0,r=n.length;s<r;s++)if(e=t(e,n[s]),gt(e)){e=e.deref();break}return e},jo=(t,e,n)=>{for(let s of n)if(e=t(e,s),gt(e)){e=e.deref();break}return e},Ve=(t,e)=>[t,n=>n,e];function bn(t){return t?[...t]:Ve(()=>[],(e,n)=>(e.push(n),e))}function*we(t,e){let n=yn(t)(bn()),s=n[1],r=n[2];for(let i of e){let o=r([],i);if(gt(o)){yield*Qt(s(o.deref()));return}o.length&&(yield*o)}yield*Qt(s([]))}function*Le(t,e){let n=yn(t)([_e,_e,(s,r)=>r])[2];for(let s of e){let r=n(Yn,s);if(gt(r)){r=Qt(r.deref()),r!==Yn&&(yield r);return}r!==Yn&&(yield r)}}var Ge=(t,e,n=Le)=>{let s=e.length-1;return me(e[s])?e.length>1?n(t.apply(null,e.slice(0,s)),e[s]):n(t(),e[0]):void 0},be=(t,e)=>[t[0],t[1],e];function J(t,e){return me(e)?Le(J(t),e):n=>{let s=n[2];return be(n,(r,i)=>s(r,t(i)))}}function Ae(...t){return xo(Ae,Jn,t)}var xo=(t,e,n)=>{let s,r;switch(n.length){case 4:r=n[3],s=n[2];break;case 3:r=n[2];break;case 2:return J(i=>t(n[0],n[1],i));default:Qn(n.length)}return e(yn(n[0])(n[1]),s,r)};function tr(...t){let[e,n,s,r,i,o,c,l,a,u]=t;switch(t.length){case 0:Qn(0);case 1:return e;case 2:return(...f)=>e(n(...f));case 3:return(...f)=>e(n(s(...f)));case 4:return(...f)=>e(n(s(r(...f))));case 5:return(...f)=>e(n(s(r(i(...f)))));case 6:return(...f)=>e(n(s(r(i(o(...f))))));case 7:return(...f)=>e(n(s(r(i(o(c(...f)))))));case 8:return(...f)=>e(n(s(r(i(o(c(l(...f))))))));case 9:return(...f)=>e(n(s(r(i(o(c(l(a(...f)))))))));case 10:default:let h=(...f)=>e(n(s(r(i(o(c(l(a(u(...f))))))))));return t.length===10?h:tr(h,...t.slice(10))}}function Mo(t,e){t=t||"";let n=!0;return e?[...e].join(t):Ve(()=>"",(s,r)=>(s=n?s+r:s+t+r,n=!1,s))}function nr(t,e,n){return new er(t,e,n)}var er=class{constructor(e,n,s){e===void 0?(e=0,n=Infinity):n===void 0&&(n=e,e=0),s=s===void 0?e<n?1:-1:s,this.from=e,this.to=n,this.step=s}*[Symbol.iterator](){let{from:e,to:n,step:s}=this;if(s>0)for(;e<n;)yield e,e+=s;else if(s<0)for(;e>n;)yield e,e+=s}$reduce(e,n){let s=this.step;if(s>0)for(let r=this.from,i=this.to;r<i&&!gt(n);r+=s)n=e(n,r);else for(let r=this.from,i=this.to;r>i&&!gt(n);r+=s)n=e(n,r);return n}};function*sr(...t){let e=t.map(n=>n[Symbol.iterator]());for(;;){let n=[];for(let s of e){let r=s.next();if(r.done)return;n.push(r.value)}yield n}}var K=Math.PI,R=K*2,Oe=K/2,Io=K/3,Po=K/180,qo=Math.SQRT2,Co=Math.sqrt(3),ko=qo/2,y=1e-6;function An(...t){return Ge(An,t)||(e=>{let n=e[2],s=t[0],r=t[1]||0;return be(e,(i,o)=>n(i,s(r++,o)))})}function Se(...t){return t=t.map(yn),tr.apply(null,t)}function rr(t,e){return me(e)?we(rr(t),e):n=>{let s=n[2],r=t;return be(n,(i,o)=>--r>0?s(i,o):r===0?wn(s(i,o)):No(i))}}var zo=t=>([e,n,s])=>`${e}=${n}${t}${s};`,Ro=t=>([e,n])=>`${e}=${n}${t}n;`,ir=(t,e)=>([n,s,r,i])=>`${n}=(${s}${t}${r})${e}${i};`,Kn=(t,e)=>([n,s,r])=>`${n}=(${s}${t}${r})${e}n;`,or=(t,e)=>([n,s,r])=>`${n}=(${s}${t}n)${e}${r};`,cr=(t="op")=>([e,n])=>`${e}=${t}(${n});`,ts=(t="op")=>([e,n,s])=>`${e}=${t}(${n},${s});`,lr=(t="op")=>([e,n])=>`${e}=${t}(${n},n);`,On=([t,e])=>`${t}*${e}`,ar=([t,e])=>`s+=${t}*${e};`,ur=([t,e])=>`${t}=${e};`,hr=([t])=>`${t}=n;`,fr=([t,e,n])=>`${t}=${e}+(${n}-${e})*n;`,q=(t=0)=>{let e=new Array(5),n,s=(...r)=>{let i=e[r[t].length]||n;return i?i(...r):gn(`no impl for vec size ${r[t].length}`)};return s.add=(r,i)=>e[r]=i,s.default=r=>n=r,s.impl=r=>e[r]||n,s},dr="o,a",es="o,a,b",pr="o,a,b,c",ns="o,a,n",mr="o,a,n,b",Ue="o,a,b,n",gr="io=0,ia=0,so=1,sa=1",yr="!o&&(o=[]);",Do=t=>e=>e>1?`${t}[i${t}+${e}*s${t}]`:e==1?`${t}[i${t}+s${t}]`:`${t}[i${t}]`,vo=t=>J(Do(t),nr()),Fo=t=>J(e=>`${t}[${e}]`,nr()),wr=(t,e,n,s="a",r="",i="",o="",c=!1)=>[i,Ae(Se(rr(t),An((l,a)=>e(a,l))),Mo(r),sr.apply(null,n.split(",").map(c?vo:Fo))),o,s!==""?`return ${s};`:""],br=(t,e,n="a",s,r,i=!1)=>[s,"for(let i=a.length;--i>=0;) {",t(e.split(",").map(i?o=>`${o}[i${o}+i*s${o}]`:o=>`${o}[i]`)),"}",r,n!==null?`return ${n};`:""],Ar=(t,e)=>`!${t} && (${t}=${e.split(",")[1]});`,Et=(t,e,n,s=n,r="a",i,o,c,l=!1)=>new Function(n,wr(t,e,s,r,i,o,c,l).join("")),ss=(t,e,n,s,r,i=r,o="a",c="",l,a,u=!1)=>new Function(s,`return (${r})=>{${wr(t,n,i,o,c,l,a,u).join("")}}`)(...e),Yt=(t,e,n=e,s="a",r,i,o=!1)=>new Function(e,br(t,n,s,r,i,o).join("")),$o=(t,e,n,s,r=s,i="a",o,c,l=!1)=>new Function(n,`return (${s})=>{${br(e,r,i,o,c,l).join("")}}`)(...t),D=(t,e=es,n,s="o",r=1,i)=>{n=n||e,i=i!=null?i:Ar(s,e);let o=q(r),c=l=>o.add(l,Et(l,t,e,n,s,"",i));return o.default(Yt(t,e,n,s,i)),[o,c(2),c(3),c(4)]},Or=t=>D(cr(t),dr),We=(t,e,n=dr,s,r="o",i=1,o)=>{let c=e||cr("op");s=s||n,o=o!=null?o:Ar(r,n);let l=u=>ss(u,[t],c,"op",n,s,r,"",o),a=q(i);return a.default($o([t],c,"op",n,s,r,o)),[a,l(2),l(3),l(4)]},Jt=t=>D(zo(t)),Kt=t=>D(Ro(t),ns);var Bo=ge(()=>"illegal argument(s)"),jt=t=>{throw new Bo(t)},Sr=([t,e])=>`t=${t}-${e};s+=t*t;`,Nr="let t,s=0;",rs=t=>j.add(t,Et(t,Sr,"a,b",void 0,"s","",Nr)),j=q();j.default(Yt(Sr,"a,b",void 0,"s",Nr));var Tr=rs(2),zu=rs(3),Ru=rs(4);var is=t=>tt.add(t,Et(t,([e])=>`${e}*${e}`,"a","a","","+","return ",";")),tt=q();tt.default(Yt(([t])=>`sum+=${t}*${t};`,"a",void 0,"sum","let sum=0;"));var Er=is(2),Fu=is(3),$u=is(4),[d,N,Ne,Bu]=D(ur,"o,a",void 0,"o",1,yr);var H=t=>typeof t=="number",[_,C,te,Vu]=Jt("+");var xt=-Infinity,Mt=Infinity,os=Object.freeze([xt,xt]),cs=Object.freeze([Mt,Mt]),Zu=Object.freeze([1,1]),Vt=Object.freeze([0,0]),jr=Object.freeze([1,0]),Qu=Object.freeze([0,1]),xr=Object.freeze([xt,xt,xt]),Mr=Object.freeze([Mt,Mt,Mt]),Yu=Object.freeze([1,1,1]),Sn=Object.freeze([0,0,0]),Ju=Object.freeze([1,0,0]),Ku=Object.freeze([0,1,0]),Ho=Object.freeze([0,0,1]),th=Object.freeze([xt,xt,xt,xt]),eh=Object.freeze([Mt,Mt,Mt,Mt]),nh=Object.freeze([1,1,1,1]),sh=Object.freeze([0,0,0,0]),rh=Object.freeze([1,0,0,0]),ih=Object.freeze([0,1,0,0]),oh=Object.freeze([0,0,1,0]),ch=Object.freeze([0,0,0,1]),Te=(t,e=y)=>t>e?1:t<-e?-1:0,_o=Math.abs,et=(t,e,n=y)=>_o(t-e)<=n,It=(t,e,n)=>t<e?e:t>n?n:t,v=t=>t<0?0:t>1?1:t;var Xe=(t,e,n)=>t>=e&&t<=n,ls=t=>ee.add(t,ss(t,[et,y],([e,n])=>`eq(${e},${n},eps)`,"eq,_eps","a,b,eps=_eps","a,b","","&&","return a.length === b.length && ",";")),ee=q();ee.default((t,e,n=y)=>ot(t,"eqDelta")?t.eqDelta(e,n):ot(e,"eqDelta")?e.eqDelta(t,n):Vo(t,e,t.length,n));var Ze=ls(2),lh=ls(3),ah=ls(4),Vo=(t,e,n,s=y,r=0,i=0,o=1,c=1)=>{for(;n>0;n--,r+=o,i+=c)if(!et(t[r],e[i],s))return!1;return!0},Ir=(t,e,n=y)=>{for(let s=e.length;--s>=0;)if(ee(t,e[s],n))return!0;return!1},as=t=>ct.add(t,Et(t,On,"a,b",void 0,"","+","return ",";")),ct=q();ct.default(Yt(ar,"a,b",void 0,"s","let s=0;"));var uh=as(2),Pr=as(3),hh=as(4),[k,Pt,qr,fh]=Jt("-"),[E,us,dh,ph]=D(fr,Ue),$=(t,e,n)=>{let s=t[0],r=t[1];return(e[0]-s)*(n[1]-r)-(n[0]-s)*(e[1]-r)},ne=(t,e,n,s=y)=>Te($(t,e,n),s),Cr=(t,e,n,s=y)=>ne(t,e,n,s)<0,[hs,mh,gh,yh]=Kt("/"),[wh,bh,Ah,Oh]=D(hr,"a,n","a","a",0,""),Qe=t=>new Array(t).fill(0),fs=t=>ot(t,"empty")?t.empty():Qe(t.length),S;(function(t){t[t.NONE=0]="NONE",t[t.PARALLEL=1]="PARALLEL",t[t.COINCIDENT=2]="COINCIDENT",t[t.COINCIDENT_NO_INTERSECT=3]="COINCIDENT_NO_INTERSECT",t[t.INTERSECT=4]="INTERSECT",t[t.INTERSECT_OUTSIDE=5]="INTERSECT_OUTSIDE"})(S||(S={}));var Ye=(t,e,n)=>{let s=k([],n,e),r=tt(s);return r>1e-6?ct(k([],t,e),s)/r:void 0},se=(t,e,n,s,r=!1,i=0)=>{let o=Ye(t,e,n);if(o!==void 0&&(!r||o>=i&&o<=1-i))return s=s||fs(t),o<=0?d(s,e):o>=1?d(s,n):E(s,e,n,o)},Nn=(t,e,n=!1,s=[])=>{if(!e.length)return;let r=[],i=e.length-1,o=Infinity,c,l;for(n?(c=i,l=0):(c=0,l=1);l<=i;c=l,l++)if(se(t,e[c],e[l],r)){let a=j(t,r);a<o&&(o=a,d(s,r))}return o<Infinity?s:void 0},kr=(t,e,n,s=0,r=n.length)=>{let i=-1,o=-1,c=fs(t);for(let l=s;l<r;l++){let a=n[l],u=j(a,se(a,t,e,c)||t);u>i&&(i=u,o=l)}return[o,Math.sqrt(i)]},Lt=(t,e)=>{let n=t.length;!n&&jt("no points"),!e&&(e=fs(t[0]));for(let s=n;--s>=0;)_(e,e,t[s]);return hs(e,e,n)},ds=(t,e,n,s=y)=>{let r=t[0],i=t[1],o=e[0],c=e[1],l=n[0],a=n[1],u=o-r,h=c-i,f=l-o,g=a-c,w=Math.abs(h),O=Math.abs(g);if(w<s&&O<s||Math.abs(u)<s&&Math.abs(f)<s)return;let B=(r+o)/2,mt=(i+c)/2,Q=(o+l)/2,Y=(c+a)/2;if(w<s)return[B,-f/g*(B-Q)+Y];if(O<s)return[Q,-u/h*(Q-B)+mt];let P=-u/h,Ht=-f/g,Nt=B,_t=mt,Tt=Q,X=Y,Xn=(P*Nt-Ht*Tt+X-_t)/(P-Ht),Ao=w>O?P*(Xn-Nt)+_t:Ht*(Xn-Tt)+X;return[Xn,Ao]},Tn=(t,e,n,s=y)=>{let r=Ye(t,e,n);return r!==void 0?j(t,E([],e,n,v(r)))<s*s:!1},zr=(t,e,n)=>j(e,t)<=n*n,Rr=(t,e,n,s=y)=>Te(n*n-j(e,t),s),Dr=(t,e,n,s)=>tt(t)*$(e,n,s)-tt(e)*$(t,n,s)+tt(n)*$(t,e,s)-tt(s)*$(t,e,n)>0,vr=(t,e,n,s)=>{let r=Cr(e,n,s)?1:-1;return r*$(e,s,t)>=0&&r*$(n,e,t)>=0&&r*$(s,n,t)>=0},Fr=(t,e,n,s,r=y)=>{let i=Cr(e,n,s)?1:-1;return Te(Math.min(i*$(e,s,t),i*$(n,e,t),i*$(s,n,t)),r)},qt=(t,e)=>{let n=e.length-1,s=t[0],r=t[1],i=e[n],o=e[0],c=0;for(let l=0;l<=n;i=o,o=e[++l])c=Lo(s,r,i[0],i[1],o[0],o[1],c);return c},Lo=(t,e,n,s,r,i,o)=>(s<e&&i>=e||i<e&&s>=e)&&(n<=t||r<=t)?o^(n+(e-s)/(i-s)*(r-n)<t?1:0):o,ps=q(0),$r=ps.add(2,([t,e],n,s)=>t>=n[0]&&t<=n[0]+s[0]&&e>=n[1]&&e<=n[1]+s[1]),Br=ps.add(3,([t,e,n],s,r)=>t>=s[0]&&t<=s[0]+r[0]&&e>=s[1]&&e<=s[1]+r[1]&&n>=s[2]&&n<=s[2]+r[2]);ps.default((t,e,n)=>{for(let s=t.length;--s>=0;){let r=t[s],i=e[s];if(r<i||r>i+n[s])return!1}return!0});var ms=q(0),Sh=ms.add(2,([t,e],n,s)=>t>=n[0]-s[0]&&t<=n[0]+s[0]&&e>=n[1]-s[1]&&e<=n[1]+s[1]),Nh=ms.add(3,([t,e,n],s,r)=>t>=s[0]-r[0]&&t<=s[0]+r[0]&&e>=s[1]-r[1]&&e<=s[1]+r[1]&&n>=s[2]-r[2]&&n<=s[2]+r[2]);ms.default((t,e,n)=>{for(let s=t.length;--s>=0;){let r=t[s],i=e[s],o=n[s];if(r<i-o||r>i+o)return!1}return!0});var En=(t,e,n,s,r=y)=>{let i=e[0]-t[0],o=e[1]-t[1],c=s[0]-n[0],l=s[1]-n[1],a=t[0]-n[0],u=t[1]-n[1],h=l*i-c*o,f=c*u-l*a,g=i*u-o*a;if(et(h,0,r)){if(et(f,0,r)&&et(g,0,r)){let O=se(n,t,e,void 0,!0)||se(s,t,e,void 0,!0);return{type:O?S.COINCIDENT:S.COINCIDENT_NO_INTERSECT,isec:O}}return{type:S.PARALLEL}}f/=h,g/=h;let w=1-r;return{type:r<f&&f<w&&r<g&&g<w?S.INTERSECT:S.INTERSECT_OUTSIDE,isec:us([],t,e,f),alpha:f,beta:g,det:h}},gs=(t,e,n,s,r=[],i=[])=>{let o=Go(t[0],t[1],e[0],e[1],n[0],n[1],s[0],s[1]);if(!!o)return r[0]=o[0],r[1]=o[1],i[0]=o[2],i[1]=o[3],[r,i,o[4],o[5]]},Go=(t,e,n,s,r,i,o,c)=>{let l=n-t,a=s-e,u=0,h=1,f=(g,w)=>{if(g<0){let O=w/g;if(O>h)return!1;O>u&&(u=O)}else if(g>0){let O=w/g;if(O<u)return!1;O<h&&(h=O)}else if(w<0)return!1;return!0};return f(-l,t-r)&&f(l,o-t)&&f(-a,e-i)&&f(a,c-e)?[u*l+t,u*a+e,h*l+t,h*a+e,u,h]:void 0},Ee=(t,e,n,s=y)=>{n=n||Lt(e);for(let r=e.length,i=r-1,o=0;o<r;i=o,o++){let c=[],l=e[i],a=e[o],u=ne(l,a,n,s);for(let h=t.length,f=h-1,g=0;g<h;f=g,g++){let w=t[f],O=t[g],B=ne(l,a,O,s);ne(l,a,w,s)===u?c.push(B!==u?En(l,a,w,O).isec:O):B===u&&c.push(En(l,a,w,O).isec,O)}if(c.length<2)return[];t=c}return t};var Je=0,lt=class{constructor(e,n){this.parent=e,this.id=n}static create(e,n){let s=new Array(4),r=s[0]=new lt(s,Je),i=s[1]=new lt(s,Je+1),o=s[2]=new lt(s,Je+2),c=s[3]=new lt(s,Je+3);return r.onext=r,o.onext=o,i.onext=c,c.onext=i,Je+=4,e&&n&&r.setEnds(e,n),r}get oprev(){return this.rot.onext.rot}get rot(){return this.parent[this.id+1&3]}get invrot(){return this.parent[this.id+3&3]}get sym(){return this.parent[this.id+2&3]}get dnext(){return this.sym.onext.sym}get dprev(){return this.invrot.onext.invrot}get lnext(){return this.invrot.onext.rot}get lprev(){return this.onext.sym}get rnext(){return this.rot.onext.invrot}get rprev(){return this.sym.onext}get dest(){return this.sym.origin}setEnds(e,n){this.origin=e,this.sym.origin=n}connect(e){let n=lt.create();return n.splice(this.lnext),n.sym.splice(e),n.setEnds(this.dest,e.origin),n}swap(){let e=this.oprev,n=this.sym.oprev;this.splice(e),this.sym.splice(n),this.splice(e.lnext),this.sym.splice(n.lnext),this.setEnds(e.dest,n.dest)}remove(){this.splice(this.oprev),this.sym.splice(this.sym.oprev),delete this.parent}splice(e){let n=this.onext.rot,s=e.onext.rot,r=e.onext,i=this.onext,o=s.onext,c=n.onext;return this.onext=r,e.onext=i,n.onext=o,s.onext=c,this}},jn=(t,e)=>$(t,e.dest.pos,e.origin.pos)>0,ys=class{constructor(e,n=1e5){let s={pos:[0,-n],id:0},r={pos:[n,n],id:1},i={pos:[-n,n],id:2},o=lt.create(s,r),c=lt.create(r,i),l=lt.create(i,s);o.sym.splice(c),c.sym.splice(l),l.sym.splice(o),this.first=o,this.nextID=3,e&&e.length?H(e[0][0])?this.addKeys(e):this.addAll(e):this.computeDual()}add(e,n,s=y,r=!0){let[i,o]=this.locate(e,s);if(o)return!1;Tn(e,i.origin.pos,i.dest.pos)&&(i=i.oprev,i.onext.remove());let c=lt.create(i.origin,{pos:e,id:this.nextID++,val:n});c.splice(i);let l=c;do c=i.connect(c.sym),i=c.oprev;while(i.lnext!==l);do{let a=i.oprev;if(jn(a.dest.pos,i)&&Dr(i.origin.pos,a.dest.pos,i.dest.pos,e))i.swap(),i=i.oprev;else if(i.onext!==l)i=i.onext.lprev;else break}while(!0);return r&&this.computeDual(),!0}addKeys(e,n){for(let s of e)this.add(s,void 0,n,!1);this.computeDual()}addAll(e,n){for(let s of e)this.add(s[0],s[1],n,!1);this.computeDual()}locate(e,n=y){let s=this.first;for(;;){if(Ze(e,s.origin.pos,n)||Ze(e,s.dest.pos,n))return[s,!0];if(jn(e,s))s=s.sym;else if(!jn(e,s.onext))s=s.onext;else if(!jn(e,s.dprev))s=s.dprev;else return[s,!1]}}computeDual(){let e=[this.first.rot],n={},s={};for(;e.length;){let r=e.pop();if(!n[r.id]){if(n[r.id]=!0,!r.origin||!s[r.origin.id]){let i=r.rot,o=i.origin.pos,c=i.origin.id<3;i=i.lnext;let l=i.origin.pos;c=c&&i.origin.id<3,i=i.lnext;let a=i.origin.pos;c=c&&i.origin.id<3;let u=this.nextID++;r.origin={pos:c?Vt:ds(o,l,a),id:u},s[u]=!0}e.push(r.sym,r.onext,r.lnext)}}}delaunay(e){let n=[],s={},r=e&&Lt(e);return this.traverse(i=>{if(!s[i.id]){let o=i.lnext,c=o.lnext,l=i.origin.pos,a=o.origin.pos,u=c.origin.pos,h=[l,a,u];e&&!(qt(l,e)&&qt(a,e)&&qt(u,e))?(h=Ee(h,e,r),h.length>2&&n.push(h)):n.push(h),s[i.id]=s[o.id]=s[c.id]=!0}}),n}voronoi(e){let n=[],s=e&&Lt(e);return this.traverse(e?r=>{let i=r=r.rot,o=[],c=!1,l;do l=r.origin.pos,o.push(l),c=c||!qt(l,e);while((r=r.lnext)!==i);c&&(o=Ee(o,e,s),o.length<3)||n.push(o)}:r=>{let i=r=r.rot,o=[];do o.push(r.origin.pos);while((r=r.lnext)!==i);n.push(o)},!1),n}edges(e=!1,n){let s=[],r={};return this.traverse(i=>{if(!(r[i.id]||r[i.sym.id])){if(i.origin.id>2&&i.dest.id>2){let o=i.origin.pos,c=i.dest.pos;if(n){let l=gs(o,c,n[0],n[1]);l&&s.push([l[0],l[1]])}else s.push([o,c])}r[i.id]=!0}},!0,e?this.first.rot:this.first),s}traverse(e,n=!0,s=this.first){let r=[s],i={},o={};for(;r.length;){if(s=r.pop(),i[s.id])continue;i[s.id]=!0;let c=s.origin.id;c>2&&s.rot.origin.id>2&&(n||!o[c])&&(o[c]=!0,e(s,i,o)),r.push(s.sym,s.onext,s.lnext)}}};var Ke=Array.isArray,Hr=Object.getPrototypeOf({}),xn="function",_r="string",at=(t,e)=>{let n;if(t===e)return!0;if(t!=null){if(typeof t.equiv===xn)return t.equiv(e)}else return t==e;if(e!=null){if(typeof e.equiv===xn)return e.equiv(t)}else return t==e;return typeof t===_r||typeof e===_r?!1:(n=Object.getPrototypeOf(t),(n==null||n===Hr)&&(n=Object.getPrototypeOf(e),n==null||n===Hr)?Zo(t,e):typeof t!==xn&&t.length!==void 0&&typeof e!==xn&&e.length!==void 0?Uo(t,e):t instanceof Set&&e instanceof Set?Wo(t,e):t instanceof Map&&e instanceof Map?Xo(t,e):t instanceof Date&&e instanceof Date?t.getTime()===e.getTime():t instanceof RegExp&&e instanceof RegExp?t.toString()===e.toString():t!==t&&e!==e)},Uo=(t,e,n=at)=>{let s=t.length;if(s===e.length)for(;--s>=0&&n(t[s],e[s]););return s<0},Wo=(t,e,n=at)=>t.size===e.size&&n([...t.keys()].sort(),[...e.keys()].sort()),Xo=(t,e,n=at)=>t.size===e.size&&n([...t].sort(),[...e].sort()),Zo=(t,e,n=at)=>{if(Object.keys(t).length!==Object.keys(e).length)return!1;for(let s in t)if(!e.hasOwnProperty(s)||!n(t[s],e[s]))return!1;return!0},Qo=t=>((t==null||!t[Symbol.iterator])&&jt(`value is not iterable: ${t}`),t),Mn=t=>Ke(t)?t:[...Qo(t)];var Vr=1/4294967295,Lr=class{float(e=1){return this.int()*Vr*e}norm(e=1){return(this.int()*Vr-.5)*2*e}minmax(e,n){return this.float()*(n-e)+e}},ws=Math.random,Gr=class extends Lr{int(){return ws()*4294967296>>>0}float(e=1){return ws()*e}norm(e=1){return(ws()-.5)*2*e}},re=new Gr,[ut,In,bs,Rh]=Kt("*"),Pn=t=>Math.sqrt(tt(t)),ht=(t,e,n=1)=>{!t&&(t=e);let s=Pn(e);return s>=y?ut(t,e,n/s):t!==e?d(t,e):t},[Yo,Dh,vh,Fh]=We(re,([t])=>`${t}=rnd.minmax(n,m);`,"a,n=-1,m=1,rnd=op","a","a",0,"!a && (a=[]);"),Jo=t=>(e,n=1,s=re)=>ht(t(e=e||[],-1,1,s),e,n),Ur=Jo(Yo),[Ko,As,$h,Bh]=We(re,([t,e,n])=>`${t}=rnd.minmax(${e},${n});`,"o,a,b,rnd=op","o,a,b");var je=t=>typeof t=="function",yt=t=>typeof t=="string",tc={},Wr=t=>t!=null&&typeof t!="string"&&typeof t[Symbol.iterator]=="function",Xr=Object.getPrototypeOf,xe=t=>{let e;return t!=null&&typeof t=="object"&&((e=Xr(t))===null||Xr(e)===null)};function tn(t,e){return!e&&(e={}),(...n)=>{let s=JSON.stringify(n);return s!==void 0?s in e?e[s]:e[s]=t.apply(null,n):t.apply(null,n)}}var Zr=tn((t,e)=>t.repeat(e)),Qr="0123456789abcdef",Os=t=>Qr[t>>>4&15]+Qr[t&15],ec=t=>Os(t>>>8)+Os(t&255),nc=t=>Os(t>>>16)+ec(t),Ss=tn((t,e,n="")=>{let s=Zr("0",e);return r=>(r=(r>>>0).toString(t),n+(r.length<e?s.substr(r.length)+r:r))}),Yh=Ss(2,8),Jh=Ss(2,16),Kh=Ss(2,32),Yr=nc,qn=tn((t,e=" ")=>{let n=Zr(String(e),t);return(s,r)=>s==null?n:(s=s.toString(),r=r!==void 0?r:s.length,r<t?n.substr(r)+s:s)}),tf=qn(2,"0"),ef=qn(3,"0"),nf=qn(4,"0"),sc=tn((t,e=!1)=>e?n=>Jr(n)||n.toFixed(t):n=>n.toFixed(t)),sf=tn((t,e=3)=>{let n=t-e-1,s=Math.pow(10,n),r=-Math.pow(10,n-1),i=Math.pow(10,-(e-1)),o=qn(t);return c=>{let l=Math.abs(c);return o(Jr(c)||(c===0?"0":l<i||l>=s?rc(c,t):c.toFixed(e-(c<r?1:0))))}}),rc=(t,e)=>t.toExponential(Math.max(e-4-(Math.log(Math.abs(t))/Math.LN10>=10?2:1)-(t<0?1:0),0)),Jr=t=>isNaN(t)?"NaN":t===Infinity?"+∞":t===-Infinity?"-∞":void 0;function*wt(t,e){let n=typeof t=="string"?t.charCodeAt(0):t,s=typeof e=="string"?e.charCodeAt(0):e;if(n<=s)for(;n<=s;n++)yield String.fromCharCode(n);else for(;n>=s;n--)yield String.fromCharCode(n)}var en=(...t)=>{let e={};for(let n of t)for(let s of n)e[s]=!0;return Object.freeze(e)},ic=Object.freeze({"	":!0,"\n":!0,"\v":!0,"\f":!0,"\r":!0," ":!0}),oc=en(wt("0","9")),rf=en(wt("0","9"),wt("A","F"),wt("a","f")),cc=en(wt("a","z")),lc=en(wt("A","Z")),ac=Object.freeze(Object.assign(Object.assign({},lc),cc)),of=Object.freeze(Object.assign(Object.assign(Object.assign({},ac),oc),{_:!0})),cf=en(wt("!","/"),wt(":","@"),wt("[","`"),wt("{","~")),uc=ge(()=>"illegal state"),hc=t=>{throw new uc(t)},fc=(t=0)=>e=>(e*100).toFixed(t)+"%",Kr=t=>t!=null&&typeof t.deref=="function",Me=t=>Kr(t)?t.deref():t,Ns;(function(t){t[t.FINE=0]="FINE",t[t.DEBUG=1]="DEBUG",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.SEVERE=4]="SEVERE",t[t.NONE=5]="NONE"})(Ns||(Ns={}));var dc=(()=>{try{return tc.env.UMBRELLA_ASSERTS==="1"}catch(t){}return!1})()?(t,e="assertion failed")=>{if(typeof t=="function"&&!t()||!t)throw new Error(typeof e=="function"?e():e)}:_e,pc=Object.freeze({level:Ns.NONE,fine(){},debug(){},info(){},warn(){},severe(){}});function ti(t){return t?Jn(ti(),t):Ve(_e,(e,n)=>n)}var ei=()=>t=>{let e=t[2];return be(t,(n,s)=>{if(s){for(let r of Qt(s))if(n=e(n,r),gt(n))break}return gt(s)?wn(n):n})},Ts=(t,e=1)=>[Math.sin(t)*e,Math.cos(t)*e],nn=(t,e=1)=>[Math.cos(t)*e,Math.sin(t)*e],mc=t=>(t=Math.abs(t),t>K?R-t:t);var sn=(t,e,n)=>e+(n-e)*v(t),Ie=(t,e,n,s=16,r=8,i=0,o=1,c=y)=>{if(r<=0)return(i+o)/2;let l=(o-i)/s,a=i,u=Infinity;for(let h=0;h<=s;h++){let f=i+h*l,g=e(n,t(f));if(g<u){if(g<=c)return f;u=g,a=f}}return Ie(t,e,n,s,r-1,Math.max(a-l,0),Math.min(a+l,1))},gc=(t,e,n,s,r,i)=>{let o=1-r,c=1-i;return t*o*c+e*r*c+n*o*i+s*r*i},yc=(t,e,n,s,r)=>{let i=r*r,o=1-r,c=o*o;return t*c*o+e*3*c*r+n*3*i*o+s*i*r},Es=t=>t-Math.floor(t),ni=(t,e=1)=>Math.round(t/e)*e,wc=(t,e=y)=>{let n=Es(t);return n<=e||n>=1-e?Math.round(t):t};function si(t,e){return me(e)?Le(si(t),e):n=>{let s=n[2];return be(n,(r,i)=>t(i)?s(r,i):r)}}var js=t=>t[t.length-1];function Cn(t,e){return me(e)?we(Cn(t),e):Se(J(t),ei())}function xs(...t){let e=Ge(xs,t,we);if(e)return e;let n=t[0],s,r;return typeof t[1]=="number"?(r=t[1],s=t[2]):(r=n,s=t[1]),([i,o,c])=>{let l=[],a=0;return[i,u=>(s&&l.length>0&&(u=c(u,l),l=[]),o(u)),(u,h)=>(a<=0?(l.length<n&&l.push(h),l.length===n&&(u=c(u,l),l=r<n?l.slice(r):[],a=r-n)):a--,u)]}}function ri(...t){return Ge(ri,t,we)||Se(An(t[0],t[1]),ei())}function ii(...t){return t.length>2&&Ge(ii,t,we)||(([e,n,s])=>{let[r,i,o]=t[0],c=t.length>1&&t[1]!=null?t[1]:r();return[e,l=>{let a=i(c);return a!==c&&(l=Qt(s(l,a))),c=a,n(l)},(l,a)=>(c=o(c,a),gt(c)?wn(s(l,c.deref())):s(l,c))]})}function*bc(t,e=Infinity){for(;e-- >0;)yield t}function*Ac(t,e=1,n=e){let s=Mn(t);if(!(Xe(e,0,s.length)&&Xe(n,0,s.length))&&jt(`allowed wrap range: [0..${s.length}]`),e>0)for(let r=s.length,i=r-e;i<r;i++)yield s[i];if(yield*s,n>0)for(let r=0;r<n;r++)yield s[r]}var Oc=t=>(t&255)<<16|t>>16&255|t&4278255360,[lf,Sc,af,uf]=Or("Math.abs"),[x,Pe,Nc,hf]=D(or("*","+"),mr,es),Tc=(t,e,n,s,r)=>(!t&&(t=e),x(t,n,r,ut(t,e,s))),Ec=(t,e,n,s,r,i,o)=>(!t&&(t=e),x(t,s,o,x(t,n,i,ut(t,e,r)))),oi=(t,e,n,s,r,i,o,c,l)=>(!t&&(t=e),x(t,r,l,x(t,s,c,x(t,n,o,ut(t,e,i))))),[Ms,ff,df,pf]=D(Kn("+","*"),Ue),[mf,jc,gf,yf]=Kt("+"),qe=(t,e,n)=>(!t&&(t=[]),t[0]=e,t[1]=n,t),ie=(t,e,n,s)=>(!t&&(t=[]),t[0]=e,t[1]=n,t[2]=s,t),Ct=(t,e,n,s,r)=>(!t&&(t=[]),t[0]=e,t[1]=n,t[2]=s,t[3]=r,t),xc=(t,e,n,s,r,i,o)=>(!t&&(t=[]),t[0]=e,t[1]=n,t[2]=s,t[3]=r,t[4]=i,t[5]=o,t),ci=(t,...e)=>{!t&&(t=[]);for(let n=0,s=e.length;n<s;n++)t[n]=e[n];return t},Is=(t,e)=>t[0]*e[1]-t[1]*e[0],Mc=(t,e,n)=>ie(t||e,e[1]*n[2]-e[2]*n[1],e[2]*n[0]-e[0]*n[2],e[0]*n[1]-e[1]*n[0]),li=(t,e,n=!1)=>{let s=Math.atan2(Is(t,e),ct(t,e));return n?mc(s):s},oe=(t,e,n,s=1)=>ht(null,k(t||e,n,e),s),Ic=(t,e)=>qe(t||e,-e[1],e[0]),Ps=(t,e)=>qe(t||e,e[1],-e[0]),ai=(t,e,n,s,r=1)=>(!t&&(t=[]),ht(t,Ms(t,ht(t,k(t,e,n)),ht(null,k([],s,n)),.5),r)),ui=Math.cos,hi=Math.sin,fi=q(1),di=fi.add(2,(t,e,n=Vt)=>Pe(t||e,nn(e[1]),e[0],n)),wf=fi.add(3,(t,e,n=Sn)=>{let s=e[0],r=e[1],i=e[2],o=ui(r);return ie(t||e,s*o*ui(i)+n[0],s*o*hi(i)+n[1],s*hi(r)+n[2])}),[bf,Pc,Af,Of]=Kt("-"),V=t=>ot(t,"copy")?t.copy():d([],t),qs=t=>t.map(V),[Sf,pi,Nf,Tf]=Jt("*"),Gt=(t,e)=>Math.sqrt(j(t,e)),[qc,mi,Ef,jf]=Jt("/"),Cs=t=>Et(t,On,`o,a,${gr}`,"o,a","","+","return ",";",!0),L=Cs(2),I=Cs(3),M=Cs(4),[Cc,gi,xf,Mf]=D(ir("*","+"),pr),[rn,yi,If,Pf]=D(ts("Math.max")),[on,kc,qf,Cf]=D(ts("Math.min")),[zc,kf,zf,Rf]=We(gc,([t,e,n,s,r])=>`${t}=op(${e},${n},${s},${r},u,v);`,"o,a,b,c,d,u,v"),kn=(t,e,n,s,r,i)=>{let o=1-i,c=o*o,l=i*i;return oi(t,e,n,s,r,c*o,3*c*i,3*l*o,l*i)},[Rc,Dc,Df,vf]=D(Kn("-","*"),Ue),zn=(t,e,n,s,r)=>{let i=1-r;return Ec(t,e,n,s,i*i,2*i*r,r*r)},wi=(t,e)=>ut(t,e,-1),vc=(t,e,n,s=1)=>Ps(null,oe(t||[],e,n,s));var Fc=(t,e,n,s)=>Pe(t,n,s,e),$c=(t,e,n,s)=>Nc(t,n,s,e),[Ff,Bc,$f,Bf]=D(lr("Math.pow"),ns),Hc=(t,e)=>(n,s,r)=>{n?n!==s&&d(n,s):n=s;let i=Math.sin(r),o=Math.cos(r),c=s[t],l=s[e];return n[t]=c*o-l*i,n[e]=c*i+l*o,n},_c=Hc(0,1),m=t=>Object.assign({},t.attribs),Ce=class{constructor(e=[0,0,0],n=1,s){this.pos=e,this.attribs=s,this.size=H(n)?[n,n,n]:n}get type(){return"aabb"}copy(){return new Ce(d([],this.pos),d([],this.size),m(this))}max(){return te([],this.pos,this.size)}},bt=class{constructor(e=[],n){this.points=e,this.attribs=n}*[Symbol.iterator](){yield*this.points}},Vc=(t,e,n,s,r,i,o=[])=>ce(t,e,n,sn(i,s,r),o),ce=(t,e,n,s,r=[])=>C(null,_c(null,pi(r,nn(s),e),n),t),Lc=(t,e,n,s,r)=>{let i=N([],cs),o=N([],os),c=[],l=a=>{ce(t,e,n,a,c),kc(null,i,c),yi(null,o,c)};if(l(s),l(r),s>r){let a=s;s=r,r=a}for(let a=ni(s,Oe),u=ni(r,Oe);a<u;a+=Oe)Xe(a,s,r)&&l(a);return[i,o]},Gc=(t,e,n,s,r,i,o=[],c,l)=>{let a=u=>ce(e,n,s,sn(u,r,i),o);return a(Ie(a,Tr,t,c,l))},Uc=(t,e,n,s=0,r=!1,i=!1)=>{let o=Sc([],n);if(Ze(t,e)||o[0]<y||o[1]<y)return;s%=R;let c=Dc([],t,e,.5),l=Math.cos(s),a=Math.sin(s),u=[l*c[0]+a*c[1],-a*c[0]+l*c[1]],[h,f]=Bc([],u,2),g=h/(o[0]*o[0])+f/(o[1]*o[1]);g>1&&In(o,o,Math.sqrt(g));let[w,O]=o,B=w*w,mt=O*O,Q=Math.max(0,(B*mt-B*f-mt*h)/(B*f+mt*h)),Y=(r!==i?1:-1)*Math.sqrt(Q),P=[Y*(w*u[1]/O),Y*(-(O*u[0])/w)],Ht=[l*P[0]-a*P[1]+(t[0]+e[0])/2,a*P[0]+l*P[1]+(t[1]+e[1])/2],Nt=mi(null,Pt([],u,P),o),_t=mi(null,Pt(null,wi([],u),P),o),Tt=li(jr,Nt),X=li(Nt,_t);return!i&&X>0?X-=R:i&&X<0&&(X+=R),X%=R,{center:Ht,r:o,axis:s,start:Tt,end:Tt+X,xl:r,cw:i}},At=20,Wc=(t,e,n,s=[])=>{let[r,i]=bi(t,e,n,4);return r===0?qe(s,i,It(t[1],e[1],n[1])):qe(s,It(t[0],e[0],n[0]),i)},Xc=(t,e,n,s=[])=>{let[r,i]=bi(t,e,n,6);return r===0?ie(s,i,It(t[1],e[1],n[1]),It(t[2],e[2],n[2])):r===1?ie(s,It(t[0],e[0],n[0]),i,It(t[2],e[2],n[2])):ie(s,It(t[0],e[0],n[0]),It(t[1],e[1],n[1]),i)},bi=(t,e,n,s)=>{let r=Infinity,i,o;for(let c=0;c<s;c++){let l=c>>1,a=(c&1?n:e)[l],u=Math.abs(t[l]-a);u<r&&(r=u,i=l,o=a)}return[i,o]},Zc=(t,e,n,s=[])=>_(s,e,oe(s,e,t,n)),Qc=(t,e,n)=>ct(e,t)-n,Yc=(t,e,n,s=[])=>k(s,t,ht(s,e,Qc(t,e,n))),Jc=(t,e,n=[],s=j)=>{let r=Infinity,i;for(let o=e.length;--o>=0;){let c=s(e[o],t);c<r&&(r=c,i=e[o])}return i?d(n,i):void 0},nt=class{constructor(e,n=!1){n?(this.points=e.slice(),this.points.push(e[0])):this.points=e,this.buildIndex()}totalLength(){let e=this.index;return e?e[e.length-1]:0}pointAt(e){let n=this.points,s=n.length-1;if(s<0)return;if(s===0||e<=0)return n[0];if(e>=1)return n[s];let r=this.index,i=e*r[s];for(let o=1;o<=s;o++)if(r[o]>=i)return E([],n[o-1],n[o],(i-r[o-1])/(r[o]-r[o-1]))}closestPoint(e){return Nn(e,this.points)}closestT(e){let{index:n,points:s}=this,r=[],i=[],o=Infinity,c=-1;for(let l=0,a=n.length-1;l<a;l++)if(se(e,s[l],s[l+1],r)){let u=j(e,r);u<o&&(o=u,c=l,d(i,r))}return c>=0?sn(Ye(e,s[c],s[c+1])||0,n[c],n[c+1])/this.totalLength():void 0}segmentAt(e){let n=this.indexAt(e);if(n!==void 0)return n=Math.max(1,n),[this.points[n-1],this.points[n]]}tangentAt(e,n=1){let s=this.segmentAt(e);return s?ht(null,k([],s[1],s[0]),n):void 0}splitAt(e){if(e<=0||e>=1)return[this.points];let n=this.pointAt(e);if(!n)return;let s=Math.max(1,this.indexAt(e)),r=this.points.slice(0,s),i=this.points.slice(s);return ee(r[s-1],n)||r.push(n),ee(i[0],n)||i.unshift(n),[r,i]}splitNear(e){let n=this.closestT(e);return n!==void 0?this.splitAt(n):void 0}indexAt(e){let s=this.points.length-1;if(s<0)return;if(s===0||e<=0)return 0;if(e>=1)return s;let r=this.index,i=e*r[s];for(let o=1;o<=s;o++)if(r[o]>=i)return o}sampleUniform(e,n=!1,s=[]){let{index:r,points:i}=this,o=this.totalLength(),c=e/o,l=r.length;for(let a=0,u=1;a<1;a+=c){let h=a*o;for(;h>=r[u]&&u<l;)u++;if(u>=l)break;let f=r[u-1];s.push(E([],i[u-1],i[u],(h-f)/(r[u]-f)))}return n&&s.push(d([],i[i.length-1])),s}sampleFixedNum(e,n=!1,s){return this.sampleUniform(this.totalLength()/e,n,s)}buildIndex(){let e=[0],n=this.points,s=n.length;for(let r=0,i=1;i<s;r=i,i++)e[i]=e[r]+Gt(n[r],n[i]);this.index=e}},Rn=(t,e,n=!1,s=!1)=>{if(e!==void 0){let r=new nt(t,n);return xe(e)?n?e.dist?r.sampleUniform(e.dist,e.last):r.sampleFixedNum(e.num||At,e.last):e.dist?r.sampleUniform(e.dist,e.last!==!1):r.sampleFixedNum(e.num||At,e.last!==!1):r.sampleFixedNum(e||At,!n)}return s?qs(t):t},ks=(t,e=0,n=!1)=>{let s=t.length,r=[];if(s<=2)return t.slice();n&&!ee(t[0],t[s-1],y)&&(t=t.slice(),t.push(t[0]),s++);let i=(c,l)=>{if(r[c]=r[l]=!0,l<=c+1)return;let[a,u]=kr(t[c],t[l],t,c+1,l);a<0||u<=e||(i(c,a),i(a,l))};i(0,s-1);let o=[];for(let c=0,l=n?s-1:s;c<l;c++)r[c]&&o.push(t[c]);return o},Ai=(t,e,n,s,r,i)=>{if(xe(i)&&i.dist!==void 0)return new nt(Ai(t,e,n,s,r,i.num||At)).sampleUniform(i.dist,i.last!==!1);i=H(i)?{num:i,last:!0}:Object.assign({num:At},i);let o=r-s,c=i.theta?Math.round(o/i.theta):i.num;o/=c,i.last!==!1&&c++;let l=new Array(c);for(let a=0;a<c;a++)l[a]=ce(t,e,n,s+a*o);return l},kt=class{constructor(e,n,s,r,i,o=!1,c=!1,l){this.pos=e,this.r=n,this.axis=s,this.start=r,this.end=i,this.xl=o,this.cw=c,this.attribs=l}get type(){return"arc"}copy(){return new kt(d([],this.pos),d([],this.r),this.axis,this.start,this.end,this.xl,this.cw,m(this))}equiv(e){return e instanceof kt&&at(this.pos,e.pos)&&at(this.r,e.r)&&this.start===e.start&&this.end===e.end&&this.axis===e.axis&&this.xl===e.xl&&this.cw&&e.cw}pointAt(e,n=[]){return Vc(this.pos,this.r,this.axis,this.start,this.end,e,n)}pointAtTheta(e,n=[]){return ce(this.pos,this.r,this.axis,e,n)}toHiccup(){return["path",this.attribs,[["M",this.pointAt(0)],...this.toHiccupPathSegments()]]}toHiccupPathSegments(){return[["A",this.r[0],this.r[1],this.axis,this.xl,this.cw,this.pointAt(1)]]}},ke=class{constructor(e=[0,0],n=1,s){this.pos=e,this.r=n,this.attribs=s}get type(){return"circle"}copy(){return new ke(d([],this.pos),this.r,m(this))}toHiccup(){return["circle",this.attribs,this.pos,this.r]}},zt=(t,e)=>new t(qs(e.points),m(e)),Z=class extends bt{get type(){return"cubic"}copy(){return zt(Z,this)}toHiccup(){return["path",this.attribs,[["M",this.points[0]],...this.toHiccupPathSegments()]]}toHiccupPathSegments(){let e=this.points;return[["C",e[1],e[2],e[3]]]}},cn=class{constructor(e=[0,0],n=[1,1],s){this.pos=e,this.attribs=s,this.r=H(n)?[n,n]:n}get type(){return"ellipse"}copy(){return new cn(d([],this.pos),d([],this.r),m(this))}toHiccup(){return["ellipse",this.attribs,this.pos,this.r]}},ze=class{constructor(e,n=[]){this.attribs=e,this.children=n}get type(){return"group"}*[Symbol.iterator](){yield*this.children}copy(){return this.copyTransformed(e=>e.copy())}copyTransformed(e){return new ze(m(this),this.children.map(e))}equiv(e){return e instanceof ze&&at(this.children,e.children)}toHiccup(){return["g",this.attribs,...this.children.map(e=>e.toHiccup())]}},st=class extends bt{get type(){return"line"}copy(){return zt(st,this)}toHiccup(){return["line",this.attribs,this.points[0],this.points[1]]}toHiccupPathSegments(){let[e,n]=this.points;return[e[0]===n[0]?["V",n[1]]:e[1]===n[1]?["H",n[0]]:["L",n]]}},ft=class{constructor(e=[],n){this.segments=e,this.attribs=n,this.closed=!1}get type(){return"path"}*[Symbol.iterator](){yield*this.segments}copy(){let e=new ft(this.segments.map(n=>{let s={type:n.type};return n.point&&(s.point=V(n.point)),n.geo&&(s.geo=n.geo.copy()),s}),m(this));return e.closed=this.closed,e}equiv(e){return e instanceof ft&&at(this.segments,e.segments)}add(e){this.closed&&hc("path already closed"),this.segments.push(e)}toHiccup(){let e=[],n=this.segments,s=n.length;if(s>1){for(let r=0;r<s;r++){let i=n[r];i.geo?e=e.concat(i.geo.toHiccupPathSegments()):i.point&&e.push(["M",i.point])}this.closed&&e.push(["Z"])}return["path",this.attribs||{},e]}};var Re=class extends bt{get type(){return"points"}copy(){return zt(Re,this)}toHiccup(){return["points",this.attribs,this.points]}},De=class extends bt{get type(){return"points3"}copy(){return zt(De,this)}toHiccup(){return["points3",this.attribs,this.points]}},F=class extends bt{get type(){return"poly"}copy(){return zt(F,this)}toHiccup(){return["polygon",this.attribs,this.points]}},z=class extends bt{get type(){return"polyline"}copy(){return zt(z,this)}toHiccup(){return["polyline",Object.assign(Object.assign({},this.attribs),{fill:"none"}),this.points]}toHiccupPathSegments(){let e=[];for(let n=this.points,s=n.length,r=1;r<s;r++)e.push(["L",n[r]]);return e}},le=class extends bt{get type(){return"quad"}copy(){return zt(le,this)}toHiccup(){return["polygon",this.attribs,this.points]}};var Rt=class extends bt{get type(){return"quadratic"}copy(){return zt(Rt,this)}toHiccup(){return["path",this.attribs,[["M",this.points[0]],...this.toHiccupPathSegments()]]}toHiccupPathSegments(){let e=this.points;return[["Q",e[1],e[2]]]}},Dn=class{constructor(e,n,s){this.pos=e,this.dir=n,this.attribs=s}get type(){return"ray"}copy(){return new Dn(d([],this.pos),d([],this.dir),m(this))}toHiccup(){return["line",this.attribs,this.pos,Pe([],this.dir,1e6,this.pos)]}},rt=class{constructor(e=[0,0],n=1,s){this.pos=e,this.attribs=s,this.size=H(n)?[n,n]:n}get type(){return"rect"}copy(){return new rt(d([],this.pos),d([],this.size),m(this))}max(){return C([],this.pos,this.size)}toHiccup(){return["rect",this.attribs,this.pos,this.size[0],this.size[1]]}},ln=class{constructor(e=[0,0,0],n=1,s){this.pos=e,this.r=n,this.attribs=s}get type(){return"sphere"}copy(){return new ln(Ne([],this.pos),this.r,m(this))}toHiccup(){return["sphere",this.attribs,this.pos,this.r]}},an=class{constructor(e,n,s){this.pos=e,this.body=n,this.attribs=s}get type(){return"text"}copy(){return new an(d([],this.pos),this.body,m(this))}toHiccup(){return["text",this.attribs,this.pos,this.body]}},ve=class extends bt{get type(){return"tri"}copy(){return zt(ve,this)}toHiccup(){return["polygon",this.attribs,this.points]}};var Kc=(t,e,n)=>new Ce(t,qr([],e,t),n);var tl=(t,e,n,s,r,i=!1,o=!1)=>new kt(t,H(e)?[e,e]:e,n,s,r,i,o),el=(t,e,n,s=0,r=!1,i=!1,o)=>{let c=Uc(t,e,n,s,r,i);return c?new kt(c.center,c.r,c.axis,c.start,c.end,c.xl,c.cw,o):void 0},nl=t=>{let e=t.length-1;if(e<2)return 0;let n=0,s=t[e],r=t[0];for(let i=0;i<=e;s=r,r=t[++i])n+=Is(s,r);return n/2},Oi=(t,e,n)=>{for(let s=t.length;--s>=0;){let r=t[s];on(null,e,r),rn(null,n,r)}return[e,n]},sl=(t,e=[])=>{let n=t.length-1,s=0,r=0,i=0,o=t[n],c=t[0];for(let l=0;l<=n;o=c,c=t[++l]){let a=Is(o,c);s+=a,r+=(o[0]+c[0])*a,i+=(o[1]+c[1])*a}return s=1/(s*3),e[0]=r*s,e[1]=i*s,e};var Si=(t,e=t.length,n=!1)=>{if(e<2)return 0;let s=0,r=t[0],i=t[1];for(let o=1;o<e;r=i,i=t[++o])s+=Gt(r,i);return n?s+Gt(r,t[0]):s};var zs=(t,e)=>[d([],t),E([],t,e,1/3),E([],e,t,1/3),d([],e)],rl=(t,e,n,s,r)=>{let i=ce(t,e,n,s),o=ce(t,e,n,r),c=r-s,[l,a]=e,[u,h]=Ts(n),f=h*(i[0]-o[0])/2+u*(i[1]-o[1])/2,g=-u*(i[0]-o[0])/2+h*(i[1]-o[1])/2;if(Math.abs(c)<K&&f===0&&g===0||Er(e)<y)return[zs(i,o)];let w=(Y,P)=>(Y*=l,P*=a,[h*Y-u*P+t[0],u*Y+h*P+t[1]]),O=[],B=Math.ceil(wc(Math.abs(c)/Oe,.001)),mt=c/B,Q=8/6*Math.tan(.25*mt);if(!isFinite(Q))return[zs(i,o)];for(let Y=B,P=s,Ht=Ts(P);Y>0;Y--,P+=mt){let[Nt,_t]=Ht,[Tt,X]=Ht=Ts(P+mt);O.push([w(_t,Nt),w(_t-Nt*Q,Nt+_t*Q),w(X+Tt*Q,Tt-X*Q),w(X,Tt)])}return O},il=(t,e,n,s,r,i,o)=>{t[n]=Math.min(s,o),e[n]=Math.max(s,o);let c=-s+r,l=s-2*r+i,a=-s+3*r-3*i+o,u=l*l-c*a;if(u>0){u=Math.sqrt(u);let h=f=>{if(f>0&&f<1){let g=yc(s,r,i,o,f);t[n]=Math.min(t[n],g),e[n]=Math.max(e[n],g)}};h(c/(-l-u)),h(c/(-l+u))}},ol=(t,e,n,s)=>{let r=[],i=[];for(let o=t.length;--o>=0;)il(r,i,o,t[o],e[o],n[o],s[o]);return[r,i]},cl=(t,e,n,s,r,i=[],o,c,l)=>{let a=u=>kn(i,e,n,s,r,u);return a(Ie(a,j,t,o,c,0,1,l))},Ni=(t,e,n)=>{let s=[];for(let r=0,i=t.length-1;r<i;r++){let[o,c]=t[r],[l,a]=t[r+1],u=n?e:e*Gt(o,l);s.push([o,x([],c,u,o),x([],a,-u,l),l])}return s},ll=(t,e=1/3,n=!1)=>{let s=[];for(let r=t.length,i=r-1,o=0;o<r;i=o,o++){let c=t[i],l=t[o],a=t[(o+1)%r],u=ut(null,Ps(null,ai([],c,l,a)),ne(c,l,a));s.push([d([],l),u])}return s.push(s[0]),Ni(s,e,n)},al=(t,e=1/3,n=!1)=>{let s=[[t[0],oe([],t[0],t[1])]],r=t.length-1;for(let i=1;i<r;i++){let o=t[i-1],c=t[i],l=t[i+1],a=ut(null,Ps(null,ai([],o,c,l)),ne(o,c,l));s.push([d([],c),a])}return s.push([t[r],oe([],t[r-1],t[r])]),Ni(s,e,n)},Ti=(t,e)=>{let n=[];for(let s=0,r=t.length-2;s<r;s+=2){let i=t[s],o=t[s+1],c=t[s+2];n.push([i,_(null,oe([],i,o,e),i),_(null,oe([],c,o,e),c),c])}return n},Ei=(t,e)=>{let n=[];for(let s=0,r=t.length-2;s<r;s+=2){let i=t[s],o=t[s+1],c=t[s+2];n.push([i,E([],i,o,e),E([],c,o,e),c])}return n},ul=(t,e=1,n=!1)=>{let s=[];for(let r=0,i=t.length;r<i;r++){let o=t[(r+1)%i];s.push(Ms([],t[r],o,.5),d([],o))}return s.push(s[0]),n?Ti(s,e):Ei(s,e)},hl=(t,e=1,n=!1)=>{let s=[d([],t[0]),d([],t[0])],r=t.length-1;for(let i=0;i<r;i++){let o=t[i+1];s.push(Ms([],t[i],o,.5),d([],o))}return s.push(d([],t[r])),n?Ti(s,e):Ei(s,e)},fl=(t,e,n)=>[d([],t),E([],t,e,2/3),E([],n,e,2/3),d([],n)],ji=t=>function e(n,s){if(xe(s)&&s.dist!==void 0)return new nt(e(n,s.num||At)).sampleUniform(s.dist,s.last!==!1);s=H(s)?{num:s,last:!0}:Object.assign({num:At},s);let r=[];return t(r,n,s.num),s.last&&r.push(d([],n[n.length-1])),r},dl=ji((t,[e,n,s,r],i)=>{let o=1/i;for(let c=0;c<i;c++)t.push(kn([],e,n,s,r,c*o))}),xi=(t,e,n,s,r)=>{if(r<=0||r>=1){let h=r<=0?t:s,f=[d([],h),d([],h),d([],h),d([],h)],g=[d([],t),d([],e),d([],n),d([],s)];return r<=0?[f,g]:[g,f]}let i=E([],t,e,r),o=E([],e,n,r),c=E([],n,s,r),l=E([],i,o,r),a=E([],o,c,r),u=E([],l,a,r);return[[d([],t),i,l,d([],u)],[u,a,c,d([],s)]]},pl=(t,e,n,s,r,i,o)=>xi(e,n,s,r,Ie(c=>kn([],e,n,s,r,c),j,t,i,o)),ml=(t,e,n,s,r,i,o=1)=>{let c=1-i,l=c*c,a=i*i,u=2*i*c;return ht(t,oi(t,e,n,s,r,-3*l,3*(l-u),3*(u-a),3*a),o)},gl=(t,e,n)=>{let s=v((t-e)/(t-2*e+n)),r=1-s;return r*r*t+2*r*s*e+s*s*n},yl=(t,e,n)=>{for(let s=t.length;--s>=0;)if(!Xe(t[s],e[s],n[s]))return!1;return!0},wl=(t,e,n)=>{let s=on([],t,n),r=rn([],t,n);if(!yl(e,s,r)){let i=[];for(let o=t.length;--o>=0;)i[o]=gl(t[o],e[o],n[o]);on(null,s,i),rn(null,r,i)}return[s,r]},bl=(t,e,n,s,r=[],i,o,c)=>{let l=a=>zn(r,e,n,s,a);return l(Ie(l,j,t,i,o,0,1,c))};var Al=ji((t,[e,n,s],r)=>{let i=1/r;for(let o=0;o<r;o++)t.push(zn([],e,n,s,o*i))}),Mi=(t,e,n,s)=>{if(s<=0||s>=1){let c=s<=0?t:n,l=[d([],c),d([],c),d([],c)],a=[d([],t),d([],e),d([],n)];return s<=0?[l,a]:[a,l]}let r=E([],t,e,s),i=E([],e,n,s),o=E([],r,i,s);return[[d([],t),r,o],[o,i,d([],n)]]},Ol=(t,e,n,s,r,i)=>Mi(e,n,s,Ie(o=>zn([],e,n,s,o),j,t,r,i)),Sl=(t,e,n,s,r,i=1)=>ht(t,Tc(t,k(t,n,e),k([],s,n),2*(1-r),2*r),i);var Nl=t=>rl(t.pos,t.r,t.axis,t.start,t.end).map(e=>new Z(e,m(t))),Tl=(t,e,n)=>new Z(zs(t,e),n),El=(t,e,n,s)=>new Z(fl(t,e,n),s);var Ii=(t={},e)=>new ze(t,e),Ot=Object.freeze({type:S.NONE}),jl=(t,e,n,s)=>{let r=k([],e,t),i=Pn(r);if(et(i,0))return{type:S.COINCIDENT};if(i<=n+s&&i>=Math.abs(n-s)){n*=n;let o=(n-s*s+i*i)/(2*i),c=Math.sqrt(n-o*o),l=x([],r,o/i,t),a=ut(null,Ic(null,r),c/i);return{type:S.INTERSECT,isec:[_([],l,a),k([],l,a)]}}return Ot},Pi=(t,e,n,s,r=0,i=Infinity)=>{let o=s[0]-n[0],c=s[1]-n[1],l=e[0]*c-e[1]*o;if(et(l,0))return Ot;let a=n[0]-t[0],u=n[1]-t[1],h=(c*a-o*u)/l,f=(e[1]*a-e[0]*u)/l;return h>=r&&h<=i&&f>=0&&f<=1?{type:S.INTERSECT,isec:x([],e,h,t),alpha:h}:Ot},qi=(t,e)=>e?[t[t.length-1],t[0]]:[t[0],t[1]],Ci=(t,e,n,s=!1,r=0,i=Infinity)=>{let o=n.length-1,c=i,l=0,[a,u]=qi(n,s);for(let h=0;h<=o;a=u,u=n[++h]){let f=Pi(t,e,a,u,r,i).alpha;f!==void 0&&(l++,f<c&&(c=f))}return l>0?{type:S.INTERSECT,isec:Pe([],e,c,t),inside:!(l&1),alpha:c}:Ot},xl=(t,e,n,s=!1,r=0,i=Infinity)=>{let o=n.length-1,[c,l]=qi(n,s),a=[];for(let u=0;u<=o;c=l,l=n[++u]){let h=Pi(t,e,c,l,r,i).alpha;h!==void 0&&a.push([h,Pe([],e,h,t)])}return a.length?{type:S.INTERSECT,isec:a.sort((u,h)=>u[0]-h[0]).map(u=>u[1])}:Ot},Ml=(t,e,n,s=!1)=>{let r=k([],e,t),i=Pn(r);return xl(t,ht(null,r),n,s,0,i)},Il=(t,e,n,s)=>{let r=Pr(t,n);if(et(r,1))return et(e,s)?{type:S.COINCIDENT}:Ot;let i=1/(1-r*r),o=(e-s*r)*i,c=(s-e*r)*i;return{type:S.INTERSECT,isec:[te(null,bs([],t,o),bs([],n,c)),Mc([],t,n)]}},Pl=(t,e,n,s)=>{let r=k([],n,t),i=ct(r,e),o=s*s+i*i-tt(r);if(o<0)return Ot;o=Math.sqrt(o);let c=i+o,l=i-o,a=c>=0?l>=0?c>l?[x(r,e,l,t),x([],e,c,t)]:[x(r,e,c,t),x([],e,l,t)]:[x(r,e,c,t)]:l>=0?[x(r,e,l,t)]:void 0;return a?{type:S.INTERSECT,isec:a}:Ot},ql=(t,e,n,s,r=y)=>{let i=ct(n,e),o=Te(ct(n,t)-s,r);if(i>r&&o<0||i<-r&&o>0){let c=k(null,ut([],n,s),t),l=ct(n,c)/i;return{type:S.INTERSECT,isec:x(c,e,l,t),alpha:l}}return o===0?{type:S.COINCIDENT,isec:V(t)}:Ot},Ut=Math.min,Dt=Math.max,Cl=(t,e,n,s)=>{let r=t[0],i=1/e[0],o=(n[0]-r)*i,c=(s[0]-r)*i,l=Ut(o,c),a=Dt(o,c);return r=t[1],i=1/e[1],o=(n[1]-r)*i,c=(s[1]-r)*i,[Dt(l,Ut(o,c)),Ut(a,Dt(o,c))]},kl=(t,e,n,s)=>{let r=t[0],i=1/e[0],o=(n[0]-r)*i,c=(s[0]-r)*i,l=Ut(o,c),a=Dt(o,c);return r=t[1],i=1/e[1],o=(n[1]-r)*i,c=(s[1]-r)*i,l=Dt(l,Ut(o,c)),a=Ut(a,Dt(o,c)),r=t[2],i=1/e[2],o=(n[2]-r)*i,c=(s[2]-r)*i,[Dt(l,Ut(o,c)),Ut(a,Dt(o,c))]},ki=t=>(e,n,s,r)=>{let i=t(e,n,s,r),o=i[0],c=i[1],l=o<0;return c>Dt(o,0)?l?{type:S.INTERSECT,isec:[x([],n,c,e)],alpha:c,inside:l}:{type:S.INTERSECT,isec:[x([],n,o,e),x([],n,c,e)],alpha:o,beta:c}:Ot},zl=ki(Cl),Rl=ki(kl),Rs=q(0),Dl=Rs.add(2,(t,e,n,s)=>it(n[0],t[0],e[0])+it(n[1],t[1],e[1])<=s*s),Hf=Rs.add(3,(t,e,n,s)=>it(n[0],t[0],e[0])+it(n[1],t[1],e[1])+it(n[2],t[2],e[2])<=s*s);Rs.default((t,e,n,s)=>{let r=0;for(let i=t.length;--i>=0;)r+=it(n[i],t[i],e[i]);return r<=s*s});var Ds=q(0),_f=Ds.add(2,(t,{0:e,1:n},s,r)=>it(s[0],t[0]-e,e*2)+it(s[1],t[1]-n,n*2)<=r*r),Vf=Ds.add(3,(t,{0:e,1:n,2:s},r,i)=>it(r[0],t[0]-e,e*2)+it(r[1],t[1]-n,n*2)+it(r[2],t[2]-s,s*2)<=i*i);Ds.default((t,e,n,s)=>{let r=0;for(let i=t.length;--i>=0;)r+=it(n[i],t[i]-e[i],e[i]*2);return r<=s*s});var it=(t,e,n)=>(t<e?t-e:t>e+n?t-e-n:0)**2,vl=([t,e],[n,s],[r,i],[o,c])=>!(t>r+o||r>t+n||e>i+c||i>e+s),$l=(t,e,n)=>{let s=Ml(t,e,n,!0).isec,r=qt(t,n),i=qt(e,n);return s?(r&&s.unshift(t),i&&s.push(e),Fl(s)):r&&i?[[t,e]]:void 0},Fl=t=>{let e=[];for(let n=0,s=t.length-1;n<s;n+=2)e.push([t[n],t[n+1]]);return e};var vt=Symbol(),Bl=pc;function b(t,e){let n={},s=e?Hl(e):{},r=(...i)=>{let o=t(...i),c=n[o]||vn(n,s,o)||n[vt];return c?c(...i):gn(`missing implementation for: "${o.toString()}"`)};return r.add=(i,o)=>(n[i]&&Bl.warn(`overwriting '${i.toString()}' impl`),n[i]=o,!0),r.addAll=i=>{let o=!0;for(let c in i)o=r.add(c,i[c])&&o;return o},r.remove=i=>n[i]?(delete n[i],!0):!1,r.callable=(...i)=>{let o=t(...i);return!!(n[o]||vn(n,s,o)||n[vt])},r.isa=(i,o)=>{let c=s[i];!c&&(s[i]=c=new Set),c.add(o)},r.impls=()=>{let i=new Set(Object.keys(n));for(let o in s)vn(n,s,o)&&i.add(o);return n[vt]&&i.add(vt),i},r.rels=()=>s,r.parents=i=>s[i],r.ancestors=i=>new Set(zi([],s,i)),r.dependencies=function*(){for(let i in s)for(let o of s[i])yield[i,o];for(let i in n)!s[i]&&(yield[i,void 0])},r}var vn=(t,e,n)=>{let s=e[n];if(!!s)for(let r of s){let i=t[r]||vn(t,e,r);if(i)return i}},zi=(t,e,n)=>{let s=e[n];if(s)for(let r of s)t.push(r),zi(t,e,r);return t},Hl=t=>{let e={};for(let n in t){let s=t[n];e[n]=s instanceof Set?s:new Set(s)}return e},A=t=>t.type,_l=(t,e)=>t.type+"-"+e.type,T=b(A);T.addAll({aabb:({pos:t,size:e})=>{let[n,s,r]=t,[i,o,c]=te([],t,e);return[[n,s,r],[n,s,c],[i,s,c],[i,s,r],[n,o,r],[n,o,c],[i,o,c],[i,o,r]]},arc:(t,e)=>Ai(t.pos,t.r,t.axis,t.start,t.end,e),circle:(t,e=At)=>{let n=t.pos,s=t.r,[r,i]=Ri(e,s),o=R/r;i&&r++;let c=new Array(r);for(let l=0;l<r;l++)c[l]=di(null,[s,l*o],n);return c},cubic:(t,e)=>dl(t.points,e),ellipse:(t,e=At)=>{let n=[],s=t.pos,r=t.r,[i,o]=Ri(e,Math.max(t.r[0],t.r[1])),c=R/i;o&&i++;for(let l=0;l<i;l++)n[l]=gi([],nn(l*c),r,s);return n},group:({children:t})=>t.reduce((e,n)=>e.concat(T(n)),[]),path:(t,e)=>{let n=H(e)?{num:e}:e,s=[];for(let r=t.segments,i=r.length-1,o=0;o<=i;o++){let c=r[o];c.geo&&(s=s.concat(T(c.geo,Object.assign(Object.assign({},n),{last:o===i&&!t.closed}))))}return s},points:t=>t.points,poly:(t,e)=>Rn(t.points,e,!0),polyline:(t,e)=>Rn(t.points,e),quadratic:(t,e)=>Al(t.points,e),rect:(t,e)=>{let n=t.pos,s=C([],n,t.size),r=[N([],n),[s[0],n[1]],s,[n[0],s[1]]];return e!=null?T(new F(r),e):r}});T.isa("line","polyline");T.isa("points3","points");T.isa("quad","poly");T.isa("tri","poly");var Fn=t=>Ke(t)?t:T(t),Ri=(t,e)=>H(t)?[t,!1]:[t.theta?Math.floor(R/t.theta):t.dist?Math.floor(R/(t.dist/e)):t.num||At,t.last===!0],G=b(A);G.addAll({points:(t,e)=>new F(T(t,e),m(t))});G.isa("circle","points");G.isa("ellipse","points");G.isa("line","points");G.isa("path","points");G.isa("poly","points");G.isa("polyline","points");G.isa("quad","points");G.isa("rect","points");G.isa("tri","points");var Ft=b(A);Ft.addAll({arc:Nl,circle:t=>Ft(tl(t.pos,t.r,0,0,R,!0,!0)),cubic:t=>[t],group:t=>[...Cn(Ft,t.children)],line:({attribs:t,points:e})=>[Tl(e[0],e[1],Object.assign({},t))],path:t=>[...Cn(e=>e.geo?Ft(e.geo):null,t.segments)],poly:(t,e={})=>Di(t,e,ll,ul),polyline:(t,e={})=>Di(t,e,al,hl),quadratic:({attribs:t,points:e})=>[El(e[0],e[1],e[2],Object.assign({},t))],rect:(t,e)=>Ft(G(t),e)});Ft.isa("ellipse","circle");Ft.isa("quad","poly");Ft.isa("tri","poly");var Di=(t,e,n,s)=>(e=Object.assign({breakPoints:!1,scale:1/3,uniform:!1},e),(e.breakPoints?n(t.points,e.scale,e.uniform):s(t.points,e.scale,e.uniform)).map(r=>new Z(r,m(t)))),Vl=class{constructor(e,n={}){this.attribs=e,this.opts=n,this.paths=[],this.attribs=e,this.newPath()}*[Symbol.iterator](){yield*this.paths}current(){return this.curr}newPath(){this.curr=new ft([],this.attribs),this.paths.push(this.curr),this.currP=Qe(2),this.bezierP=Qe(2),this.startP=Qe(2)}moveTo(e,n=!1){return this.opts.autoSplit!==!1&&this.curr.segments.length>0&&(this.curr=new ft([],this.attribs),this.paths.push(this.curr)),e=this.updateCurrent(e,n),N(this.startP,e),N(this.bezierP,e),this.curr.add({point:e,type:"m"}),this}lineTo(e,n=!1){return this.curr.add({geo:new st([V(this.currP),this.updateCurrent(e,n)]),type:"l"}),N(this.bezierP,this.currP),this}hlineTo(e,n=!1){return this.addHVLine(e,0,n),this}vlineTo(e,n=!1){return this.addHVLine(e,1,n),this}cubicTo(e,n,s,r=!1){return this.addCubic(this.absPoint(e,r),n,s,r),this}quadraticTo(e,n,s=!1){return this.addQuadratic(this.absPoint(e,s),n,s),this}cubicChainTo(e,n,s=!1){let r=js(this.curr.segments).type,i=V(this.currP);return r==="c"&&C(null,Pt([],i,this.bezierP),i),this.addCubic(i,e,n,s),this}quadraticChainTo(e,n=!1){let s=js(this.curr.segments).type,r=V(this.currP);return s==="q"&&Pt(null,In(null,r,2),this.bezierP),this.addQuadratic(r,e,n),this}arcTo(e,n,s,r,i,o=!1){if(et(n[0],0)||et(n[1],0))return this.lineTo(e,o);let c=V(this.currP);return this.curr.add({geo:el(c,this.updateCurrent(e,o),n,s,r,i),type:"a"}),N(this.bezierP,this.currP),this}closePath(){return this.curr.add({geo:new st([V(this.currP),V(this.startP)]),type:"l"}),this.curr.closed=!0,this}updateCurrent(e,n){return e=V(n?C(null,this.currP,e):N(this.currP,e)),e}absPoint(e,n){return n?C(null,e,this.currP):e}addHVLine(e,n,s){let r=V(this.currP);this.currP[n]=s?this.currP[n]+e:e,N(this.bezierP,this.currP),this.curr.add({geo:new st([r,V(this.currP)]),type:"l"})}addCubic(e,n,s,r){n=this.absPoint(n,r),N(this.bezierP,n),this.curr.add({geo:new Z([V(this.currP),e,n,this.updateCurrent(s,r)]),type:"c"})}addQuadratic(e,n,s){N(this.bezierP,e),this.curr.add({geo:new Rt([V(this.currP),e,this.updateCurrent(n,s)]),type:"q"})}};var Ll=(t,e)=>{let n=new ft([],e||t[0].attribs);n.segments.push({type:"m",point:t[0].points[0]});for(let s of t)n.segments.push({type:"c",geo:s});return n};var Lf=Object.assign(Object.assign({},ic),{",":!0});var vi=(t,e)=>new F(t,e);var $n=q(1),Gf=$n.add(4,(t,e,n)=>Ct(t||e,L(e,n,0,0,2),L(e,n,1,0,2),L(e,n,0,2,2),L(e,n,1,2,2))),Uf=$n.add(6,(t,e,n)=>xc(t||e,L(e,n,0,0,2),L(e,n,1,0,2),L(e,n,0,2,2),L(e,n,1,2,2),L(e,n,0,4,2)+e[4],L(e,n,1,4,2)+e[5])),Wf=$n.add(9,(t,e,n)=>ci(t||e,I(e,n,0,0,3),I(e,n,1,0,3),I(e,n,2,0,3),I(e,n,0,3,3),I(e,n,1,3,3),I(e,n,2,3,3),I(e,n,0,6,3),I(e,n,1,6,3),I(e,n,2,6,3))),Xf=$n.add(16,(t,e,n)=>ci(t||e,M(e,n,0,0,4),M(e,n,1,0,4),M(e,n,2,0,4),M(e,n,3,0,4),M(e,n,0,4,4),M(e,n,1,4,4),M(e,n,2,4,4),M(e,n,3,4,4),M(e,n,0,8,4),M(e,n,1,8,4),M(e,n,2,8,4),M(e,n,3,8,4),M(e,n,0,12,4),M(e,n,1,12,4),M(e,n,2,12,4),M(e,n,3,12,4)));var $t=q(1),Zf=$t.add(4,(t,e,n)=>qe(t||n,L(e,n,0,0,2),L(e,n,1,0,2))),Qf=$t.add(6,(t,e,n)=>qe(t||n,L(e,n,0,0,2)+e[4],L(e,n,1,0,2)+e[5])),Yf=$t.add(9,(t,e,n)=>ie(t||n,I(e,n,0,0,3),I(e,n,1,0,3),I(e,n,2,0,3))),Jf=$t.add(16,(t,e,n)=>Ct(t||n,M(e,n,0,0,4),M(e,n,1,0,4),M(e,n,2,0,4),M(e,n,3,0,4))),Fi=(t,e,n)=>{let s=I(e,n,3,0,4)+e[15];return s!==0?ie(t||n,(I(e,n,0,0,4)+e[12])/s,(I(e,n,1,0,4)+e[13])/s,(I(e,n,2,0,4)+e[14])/s):void 0};var un=(t,e,n)=>new rt(t,Pt([],e,t),n),Gl=(t,e,n)=>new rt(Pe([],e,-.5,t),e,n);var Bn=b(A);Bn.addAll({circle:t=>R*t.r,ellipse:({r:[t,e]})=>K*(3*(t+e)-Math.sqrt((3*t+e)*(3*e+t))),group:({children:t})=>t.reduce((e,n)=>e+Bn(n),0),line:({points:t})=>Gt(t[0],t[1]),poly:({points:t})=>Si(t,t.length,!0),polyline:({points:t})=>Si(t,t.length),rect:({size:t})=>2*(t[0]+t[1]),tri:({points:t})=>Gt(t[0],t[1])+Gt(t[1],t[2])+Gt(t[2],t[0])});Bn.isa("quad","poly");Bn.isa("tri","poly");var Hn=b(A);Hn.add(vt,()=>0);Hn.addAll({aabb:({size:[t,e,n]})=>2*(t*e+t*n+e*n),arc:t=>.5*Math.abs(t.start-t.end)*t.r[0]*t.r[1],circle:t=>K*t.r**2,ellipse:t=>K*t.r[0]*t.r[1],group:({children:t})=>t.reduce((e,n)=>e+Hn(n,!1),0),plane:()=>Infinity,poly:(t,e)=>{let n=nl(t.points);return e?n:Math.abs(n)},rect:t=>t.size[0]*t.size[1],sphere:t=>4*K*t.r**2,tri:(t,e)=>{let n=.5*$(...t.points);return e?n:Math.abs(n)}});Hn.isa("quad","poly");var Ul=(t,e)=>Ll(Ft(t),e||m(t)),dt=b(A);dt.addAll({cubic:(t,e)=>new z(T(t,e)),points:(t,e)=>new z(T(t,e),m(t)),path:(t,e)=>{let n=T(t,e);return t.closed&&n.push(d([],n[0])),new z(n,m(t))},poly:(t,e)=>{let n=T(t,e);return n.push(d([],n[0])),new z(n,m(t))}});dt.isa("arc","cubic");dt.isa("circle","poly");dt.isa("ellipse","poly");dt.isa("line","points");dt.isa("polyline","points");dt.isa("quad","poly");dt.isa("quadratic","cubic");dt.isa("rect","poly");dt.isa("tri","poly");var $i={"?xml":`?>
`,"!DOCTYPE":`>
`,"!ENTITY":`>
`,"!ELEMENT":`>
`,"!ATTLIST":`>
`},Bi={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"},Wl=/^([^\s\.#]+)(?:#([^\s\.#]+))?(?:\.([^\s#]+))?$/,Xl=new RegExp(`[${Object.keys(Bi).join("")}]`,"g"),Zl="__COMMENT__",Ql="!CDATA",Yl={button:1,option:1,script:1,style:1,text:1,textarea:1,title:1},vs=t=>t.split(" ").reduce((e,n)=>(e[n]=!0,e),{}),Kf=vs("animate animateColor animateMotion animateTransform circle clipPath color-profile defs desc discard ellipse feBlend feColorMatrix feComponentTransfer feComposite feConvolveMatrix feDiffuseLighting feDisplacementMap feDistantLight feDropShadow feFlood feFuncA feFuncB feFuncG feFuncR feGaussianBlur feImage feMerge feMergeNode feMorphology feOffset fePointLight feSpecularLighting feSpotLight feTile feTurbulence filter font foreignObject g image line linearGradient marker mask metadata mpath path pattern polygon polyline radialGradient rect set stop style svg switch symbol text textPath title tref tspan use view"),Hi=vs("area base br col command embed hr img input keygen link meta param source stop track use wbr ?xml"),Jl=vs("animate circle ellipse line path polygon polyline rect"),Kl={accept:",",sizes:",",srcset:","},_i=(t,e)=>{if(e=Me(e),e==null)return t;if(yt(e))return t+" "+e;let n=new Set(t.split(" "));for(let s in e)Me(e[s])?n.add(s):n.delete(s);return[...n].join(" ")},ta=(t,e,n)=>{e&&(t.id=e);let s=Me(t.class);return n?(n=n.replace(/\./g," "),t.class=s?_i(n,s):n):s&&(t.class=yt(s)?s:_i("",s)),t},ea=t=>{let e="",n;for(let s in t)n=Me(t[s]),je(n)&&(n=n(t)),n!=null&&(e+=`${s}:${n};`);return e},Fs=t=>t.replace(Xl,e=>Bi[e]),na=t=>{let e=t[0],n,s=xe(t[1]),r=s?Object.assign({},t[1]):{};return(!yt(e)||!(n=Wl.exec(e)))&&jt(`"${e}" is not a valid tag name`),e=n[1],ta(r,n[2],n[3]),t.length>1&&(t=t.slice(s?2:1).filter(i=>i!=null),t.length>0)?[e,r,t]:[e,r]},sa=t=>Object.keys(t).reduce((e,n)=>(e.push(`${n}: ${t[n]}`),e),[]).join(" "),ra=(t,e,n=!1,s=!1,r=s,i=[0])=>Wt(t,e,n,s,r,i),Wt=(t,e,n,s,r,i)=>t==null?"":Array.isArray(t)?ia(t,e,n,s,r,i):je(t)?Wt(t(e),e,n,s,r,i):ot(t,"toHiccup")?Wt(t.toHiccup(e),e,n,s,r,i):Kr(t)?Wt(t.deref(),e,n,s,r,i):Wr(t)?Vi(t,e,n,s,r,i):(t=n?Fs(String(t)):String(t),s?`<span${r?` key="${i.join("-")}"`:""}>${t}</span>`:t),ia=(t,e,n,s,r,i)=>{let o=t[0];return t.length?je(o)?Wt(o.apply(null,[e,...t.slice(1)]),e,n,s,r,i):ot(o,"render")?Wt(o.render.apply(null,[e,...t.slice(1)]),e,n,s,r,i):o===Zl?ca(t):o==Ql?la(t):yt(o)?oa(t,e,n,s,r,i):Wr(t)?Vi(t,e,n,s,r,i):jt(`invalid tree node: ${t}`):""},oa=(t,e,n,s,r,i)=>{t=na(t);let o=t[1];if(o.__skip||o.__serialize===!1)return"";r&&o.key===void 0&&(o.key=i.join("-"));let c=t[0],l=t[2]?ua(c,t[2],e,n,s,r,i):!Hi[c]&&!Jl[c]?`></${c}>`:$i[c]||"/>";return`<${c}${aa(o,n)}${l}`},aa=(t,e)=>{let n="";for(let s in t){if(s.startsWith("__"))continue;let r=ha(t,s,Me(t[s]),e);r!=null&&(n+=r)}return n},ha=(t,e,n,s)=>n==null||je(n)&&(/^on\w+/.test(e)||(n=n(t))==null)?null:n===!0?" "+e:n===!1?null:e==="data"?da(n,s):fa(e,n,s),fa=(t,e,n)=>(e=t==="style"&&xe(e)?ea(e):t==="prefix"&&xe(e)?sa(e):Ke(e)?e.join(Kl[t]||" "):e.toString(),e.length?` ${t}="${n?Fs(e):e}"`:null),da=(t,e)=>{let n="";for(let s in t){let r=Me(t[s]);je(r)&&(r=r(t)),r!=null&&(n+=` data-${s}="${e?Fs(r):r}"`)}return n},ua=(t,e,n,s,r,i,o)=>{Hi[t]&&jt(`No body allowed in tag: ${t}`);let c=$i[t],l=c?" ":">";r=r&&!c&&!Yl[t];for(let a=0,u=e.length;a<u;a++)l+=Wt(e[a],n,s,r,i,[...o,a]);return l+(c||`</${t}>`)},ca=t=>t.length>2?`
<!--
${t.slice(1).map(e=>"    "+e).join(`
`)}
-->
`:`
<!-- ${t[1]} -->
`,la=t=>`<![CDATA[
${t.slice(1).join(`
`)}
]]>`,Vi=(t,e,n,s,r,i)=>{let o=[],c=i.slice(0,i.length-1),l=0;for(let a of t)o.push(Wt(a,e,n,s,r,[...c,l++]));return o.join("")},td=Object.freeze([0,0,0,1]),ed=Object.freeze([1,1,1,1]),nd=Object.freeze([1,0,0,1]),sd=Object.freeze([0,1,0,1]),rd=Object.freeze([0,0,1,1]),id=Object.freeze([0,1,1,1]),od=Object.freeze([1,0,1,1]),cd=Object.freeze([1,1,0,1]),pa=[3.1338561,-.9787684,.0719453,-1.6168667,1.9161415,-.2289914,-.4906146,.033454,1.4052427],ma=[3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252],ga=[.96422,1,.82521],ya=[.95047,1,1.08883],_n=sc(3),Li=fc(3),wa=1/255,$s={},ba=(t,e,n,s)=>{let r=$s[n];dc(!!r,`no conversions available for ${n}`);let i=r[s];return i?i(t,e):$s.rgb[s]?r.rgb(t,$s.rgb[s]([],e)):gn(`can't convert: ${s} -> ${n}`)},ae=(t,e=1)=>t!=null?v(t):e,Bs=t=>t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055,Aa=(t,e,n=1)=>Ct(t||e,Es(e[0]),v(e[1]),v(e[2]),ae(e[3],n)),Oa=(t,e)=>{t=Aa(t||e,e);let n=t[1],s=t[2],r=(2-n)*s/2;return t[2]=r,t[1]=r&&r<1?n*s/(r<.5?r*2:2-r*2):n,t},Vn=(t,e)=>Ct(t||e,Bs(e[0]),Bs(e[1]),Bs(e[2]),ae(e[3])),Sa=(t,e,n,s=!1)=>{let r=I(e,n,0,0,3),i=I(e,n,1,0,3),o=I(e,n,2,0,3),c=ae(n[3]);return s?Ct(t||n,v(r),v(i),v(o),c):Ct(t||n,r,i,o,c)},Hs=t=>{let e=t**3;return e>.008856?e:(t-16/116)/7.787},Gi=(t,e,n=ga)=>{let s=(e[0]+.16)/1.16;return Ct(t||e,Hs(e[1]/5+s)*n[0],Hs(s)*n[1],Hs(s-e[2]/2)*n[2],ae(e[3]))},Na=(t,e)=>Gi(t,e,ya),Ta=(t,e)=>{let{1:n,2:s}=e;s*=R;let r=ae(e[3]);return n>0?Ct(t||e,e[0],Math.cos(s)*n,Math.sin(s)*n,r):Ct(t||e,e[0],0,0,r)},Ui=(t,e,n=pa)=>Sa(t,n,e),Ea=(t,e)=>Ui(t,e,ma),Wi=(t,e)=>Ui(null,Gi(t,e)),ja=(t,e)=>Ea(null,Na(t,e)),Xi=t=>{let e=_n(Es(t[0])*360),n=Li(v(t[1])),s=Li(v(t[2])),r=ae(t[3]);return r<1?`hsla(${e},${n},${s},${_n(r)})`:`hsl(${e},${n},${s})`},xa=t=>Xi(Oa([],t)),_s=t=>{let e=t>>>24;return e<255?`rgba(${t>>16&255},${t>>8&255},${t&255},${_n(e*wa)})`:`#${Yr(t&16777215)}`},Ma=Oc,Fe=t=>{let e=v(t[0])*255+.5|0,n=v(t[1])*255+.5|0,s=v(t[2])*255+.5|0,r=ae(t[3]);return r<1?`rgba(${e},${n},${s},${_n(r)})`:`#${Yr(e<<16|n<<8|s)}`},Ia=t=>Fe(Vn([],t)),Zi={abgr32:t=>_s(Ma(t[0])),argb32:t=>_s(t[0]),hsl:Xi,hsv:xa,lab50:t=>Fe(Vn(null,Wi([],t))),lab65:t=>Fe(Vn(null,ja([],t))),lch:t=>Fe(Vn(null,Wi(null,Ta([],t)))),rgb:Ia,srgb:Fe},Pa=t=>{let e;return yt(t)?t:H(t)?_s(t):t.mode?(e=Zi[t.mode])?e(t):Zi.rgb(ba([],t,"rgb",t.mode)):Fe(t)},qa=2,p=t=>t===(t|0)?t:t.toFixed(qa),Qi=t=>p(t[0])+","+p(t[1]),Vs=(t,e=" ")=>t?t.map(Qi).join(e):"",Ca=(t,...e)=>{let n;for(let s of e)(n=t[s])!=null&&(t[s]=p(n));return t},U=t=>{if(!t)return;let e=ka(t),n;return(n=t.fill)&&(e.fill=Ls(n)),(n=t.stroke)&&(e.stroke=Ls(n)),e},ka=t=>{let e;return((e=t.transform)||t.translate||t.scale||t.rotate)&&(e?(t.transform=yt(e)?e:`matrix(${[...e].map(p).join(" ")})`,delete t.translate,delete t.rotate,delete t.scale):t.transform=za(t)),t},za=t=>{let e=[],n;return(n=t.translate)&&(e.push(yt(n)?n:`translate(${p(n[0])} ${p(n[1])})`),delete t.translate),(n=t.rotate)&&(e.push(yt(n)?n:`rotate(${p(n*180/Math.PI)})`),delete t.rotate),(n=t.scale)&&(e.push(yt(n)?n:Zn(n)?`scale(${p(n[0])} ${p(n[1])})`:`scale(${p(n)})`),delete t.scale),e.join(" ")},Ls=t=>yt(t)?t[0]==="$"?`url(#${t.substr(1)})`:t:Pa(t),Yi=(t,e)=>{let n={};for(let s in t)t.hasOwnProperty(s)&&!e.has(s)&&(n[s]=t[s]);return n},Ra=(t,e,n,...s)=>["circle",U(Object.assign(Object.assign({},n),{cx:p(t[0]),cy:p(t[1]),r:p(e)})),...s],Da=(t,e,n,s,...r)=>["ellipse",U(Object.assign(Object.assign({},s),{cx:p(t[0]),cy:p(t[1]),rx:p(e),ry:p(n)})),...r],va=/(rgb|hsl)a\(([a-z0-9.-]+),([0-9.%]+),([0-9.%]+),([0-9.]+)\)/,Ji=(t,e,n)=>[t,U(e),...n.map(Fa)],Fa=([t,e])=>{e=Ls(e);let n,s=va.exec(e);return s&&(e=`${s[1]}(${s[2]},${s[3]},${s[4]})`,n=s[5]),["stop",{offset:t,"stop-color":e,"stop-opacity":n}]},$a=(t,e,n,s,r)=>Ji("linearGradient",Object.assign(Object.assign({},r),{id:t,x1:p(e[0]),y1:p(e[1]),x2:p(n[0]),y2:p(n[1])}),s),Ba=(t,e,n,s,r,i,o)=>Ji("radialGradient",Object.assign(Object.assign({},o),{id:t,fx:p(e[0]),fy:p(e[1]),cx:p(n[0]),cy:p(n[1]),fr:p(s),r:p(r)}),i),Ha=(t,e,n,...s)=>["image",U(Object.assign(Object.assign({},n),{"xlink:href":e,x:p(t[0]),y:p(t[1])})),...s],Gs=(t,e,n,...s)=>["line",U(Object.assign(Object.assign({},n),{x1:p(t[0]),y1:p(t[1]),x2:p(e[0]),y2:p(e[1])})),...s],_a=(t,e)=>Gs([-1e6,t],[1e6,t],e),Va=(t,e)=>Gs([t,-1e6],[t,1e6],e),La=180/Math.PI,Ga=(t,e,...n)=>{let s=[];for(let r of t)switch(s.push(r[0]),r[0].toLowerCase()){case"a":s.push([p(r[1]),p(r[2]),p(r[3]*La),r[4]?1:0,r[5]?1:0,p(r[6][0]),p(r[6][1])].join(","));break;case"h":case"v":s.push(p(r[1]));break;case"m":case"l":s.push(Qi(r[1]));break;case"z":break;default:s.push(Vs(r.slice(1),","))}return["path",U(Object.assign(Object.assign({},e),{d:s.join("")})),...n]},Ua=(t,e,n=1,s,...r)=>{let i=["g",U(Yi(s,new Set(["shape","size"]))),...r],o=Ki(i,e,n);for(let c of t)i.push(["use",{"xlink:href":o,x:p(c[0]),y:p(c[1])}]);return i},Wa=(t,e,n=1,s,...r)=>{s=Object.assign({start:0,cstride:1,estride:2},s);let{start:i,cstride:o,estride:c}=s,l=s&&s.num!=null?s.num:(t.length-i)/c|0,a=["g",U(Yi(s,new Set(["start","cstride","estride","shape","size","num"]))),...r],u=Ki(a,e,n);for(let h=i;--l>=0;h+=c)a.push(["use",{"xlink:href":u,x:p(t[h]),y:p(t[h+o])}]);return a},Ki=(t,e,n)=>{let s;return!e||e[0]!=="#"?(s="_"+(Math.random()*1e6|0).toString(36),t.push(["g",{opacity:0},Xa(e,s,n)]),s="#"+s):s=e,s},Xa=(t,e,n)=>{let s=p(n);if(t==="circle")return["circle",{id:e,cx:0,cy:0,r:s}];let r=p(-n/2);return["rect",{id:e,x:r,y:r,width:s,height:s}]},Za=(t,e,...n)=>["polygon",U(Object.assign(Object.assign({},e),{points:Vs(t)})),...n],Qa=(t,e,...n)=>["polyline",U(Object.assign({fill:"none",points:Vs(t)},e)),...n],Ya=(t,e,n,s,r,i,...o)=>(i=U(Object.assign(Object.assign({},i),{x:p(t[0]),y:p(t[1]),width:p(e),height:p(n)})),(s>0||r>0)&&(i.rx=p(s),i.ry=p(r)),["rect",i,...o]),Ja="http://www.w3.org/2000/svg",Ka="http://www.w3.org/1999/xlink",tu=(t,e,n,...s)=>["text",U(Object.assign(Object.assign({},n),{x:p(t[0]),y:p(t[1])})),e,...s],eu={alpha:"opacity",dash:"stroke-dasharray",dashOffset:"stroke-dashoffset",lineCap:"stroke-linecap",lineJoin:"stroke-linejoin",miterLimit:"stroke-miterlimit",weight:"stroke-width"},nu={left:"start",right:"end",center:"middle",start:"start",end:"end"},su={top:"text-top",bottom:"text-bottom"},hn=t=>{if(t==null)return null;if(ot(t,"toHiccup"))return hn(t.toHiccup());let e=t[0];if(Ke(e))return t.map(hn);let n=ru(t[1]);switch(t[0]){case"svg":case"defs":case"a":case"g":{let s=[e,U(n)];for(let r=2,i=t.length;r<i;r++){let o=hn(t[r]);o!=null&&s.push(o)}return s}case"linearGradient":return $a(n.id,n.from,n.to,t[2],{gradientUnits:n.gradientUnits||"userSpaceOnUse",gradientTransform:n.gradientTransform});case"radialGradient":return Ba(n.id,n.from,n.to,n.r1,n.r2,t[2],{gradientUnits:n.gradientUnits||"userSpaceOnUse",gradientTransform:n.gradientTransform});case"circle":return Ra(t[2],t[3],n,...t.slice(4));case"ellipse":return Da(t[2],t[3][0],t[3][1],n,...t.slice(4));case"rect":{let s=t[5]||0;return Ya(t[2],t[3],t[4],s,s,n,...t.slice(6))}case"line":return Gs(t[2],t[3],n,...t.slice(4));case"hline":return _a(t[2],n);case"vline":return Va(t[2],n);case"polyline":return Qa(t[2],n,...t.slice(3));case"polygon":return Za(t[2],n,...t.slice(3));case"path":return Ga(t[2],n,...t.slice(3));case"text":return tu(t[2],t[3],n,...t.slice(4));case"img":return Ha(t[3],t[2].src,n,...t.slice(4));case"points":return Ua(t[2],n.shape,n.size,n,...t.slice(3));case"packedPoints":return Wa(t[2],n.shape,n.size,n,...t.slice(3));default:return t}},ru=t=>{let e={};if(!t)return e;for(let n in t){let s=t[n],r=eu[n];r?e[r]=s:iu(e,n,s)}return e},iu=(t,e,n)=>{switch(e){case"font":{let s=n.indexOf(" ");t["font-size"]=n.substr(0,s),t["font-family"]=n.substr(s+1);break}case"align":t["text-anchor"]=nu[n];break;case"baseline":t["dominant-baseline"]=su[n]||n;break;case"filter":break;default:t[e]=n}},ou=(t,...e)=>(t=U(Ca(Object.assign({version:"1.1",xmlns:Ja,"xmlns:xlink":Ka},t),"width","height","stroke-width")),t.convert&&(delete t.convert,e=e.map(hn)),["svg",t,...e]),Us=(t,e,n,s)=>{let r=_([],t,e),i=_([],n,s),o=on([],t,n);return[o,k(null,rn(null,r,i),o)]},Ws=(t,e)=>{let n=t.length-1;if(n<0)return;let s=e(t[n]);if(!s)return;let{pos:r,size:i}=s;for(;--n>=0;)s=e(t[n]),!!s&&([r,i]=Us(r,i,s.pos,s.size));return[r,i]},St=b(A);St.addAll({arc:t=>un(...Lc(t.pos,t.r,t.axis,t.start,t.end)),circle:t=>new rt(Pc([],t.pos,t.r),In(null,[2,2],t.r)),cubic:({points:t})=>un(...ol(t[0],t[1],t[2],t[3])),ellipse:t=>new rt(Pt([],t.pos,t.r),pi(null,[2,2],t.r)),group:t=>{let e=Ws(t.children,St);return e?new rt(...e):void 0},line:({points:[t,e]})=>un(on([],t,e),rn([],t,e)),path:t=>{let e=Ws([...Le(Se(J(n=>n.geo),si(n=>!!n)),t.segments)],St);return e?new rt(...e):void 0},points:t=>un(...Oi(t.points,N([],cs),N([],os))),points3:t=>Kc(...Oi(t.points,Ne([],Mr),Ne([],xr))),quadratic:({points:t})=>un(...wl(t[0],t[1],t[2])),rect:t=>t.copy(),text:t=>new rt(N([],t.pos),[0,0])});St.isa("aabb","rect");St.isa("poly","points");St.isa("polyline","points");St.isa("quad","points");St.isa("tri","points");var to=(...t)=>t.map(e=>ra(hn(e))).join(""),eo=(t,...e)=>{if(e.length>0&&(!t||!t.viewBox)){let n=Ws(e,St);if(n){let[[s,r],[i,o]]=n;t=Object.assign({width:p(i),height:p(o),viewBox:`${p(s)} ${p(r)} ${p(i)} ${p(o)}`},t)}}return ou(t,...e)},W=b(A);W.addAll({circle:(t,e)=>d(e||[],t.pos),group:t=>{let e=St(t);return e?W(e):void 0},line:({points:t},e)=>E(e||[],t[0],t[1],.5),points:(t,e)=>Lt(t.points,e),plane:(t,e)=>ut(e||[],t.normal,t.w),poly:(t,e)=>sl(t.points,e),rect:(t,e)=>x(e||[],t.size,.5,t.pos),tri:({points:t},e)=>hs(null,_(null,_(e||[],t[0],t[1]),t[2]),3)});W.isa("arc","circle");W.isa("aabb","rect");W.isa("ellipse","circle");W.isa("line3","line");W.isa("points3","points");W.isa("polyline","points");W.isa("quad","poly");W.isa("sphere","circle");W.isa("text","circle");W.isa("tri3","tri");var cu=(t,e)=>t.map(n=>_([],n,e)),Bt=t=>(e,n)=>new t(cu(e.points,n),m(e)),Ln=b(A);Ln.addAll({aabb:(t,e)=>new Ce(te([],t.pos,e),Ne([],t.size),m(t)),arc:(t,e)=>{let n=t.copy();return C(null,n.pos,e),n},circle:(t,e)=>new ke(C([],t.pos,e),t.r,m(t)),cubic:Bt(Z),ellipse:(t,e)=>new cn(C([],t.pos,e),N([],t.r),m(t)),group:(t,e)=>t.copyTransformed(n=>Ln(n,e)),line:Bt(st),path:(t,e)=>new ft(t.segments.map(n=>n.geo?{type:n.type,geo:Ln(n.geo,e)}:{type:n.type,point:C([],n.point,e)}),m(t)),points:Bt(Re),points3:Bt(De),poly:Bt(F),polyline:Bt(z),quad:Bt(le),quadratic:Bt(Rt),ray:(t,e)=>new Dn(C([],t.pos,e),t.dir,m(t)),rect:(t,e)=>new rt(C([],t.pos,e),N([],t.size),m(t)),sphere:(t,e)=>new ln(te([],t.pos,e),t.r,m(t)),text:(t,e)=>new an(C([],t.pos,e),t.body,m(t)),tri:Bt(ve)});var no=b(A);no.add(vt,(t,e=Sn)=>{let n=W(t);return n?Ln(t,Rc(null,n,e,-1)):void 0});no.addAll({arc:(t,e=Vt)=>new kt(N([],e),N([],t.r),t.axis,t.start,t.end,t.xl,t.cw,m(t)),circle:(t,e=Vt)=>new ke(N([],e),t.r,m(t)),ellipse:(t,e=Vt)=>new cn(N([],e),N([],t.r),m(t)),sphere:(t,e=Sn)=>new ln(Ne([],e),t.r,m(t))});var so=b(A);so.addAll({circle:(t,e,n=y)=>Rr(e,t.pos,t.r,n),plane:(t,e,n)=>Te(ct(t.normal,e)-t.w,n),tri:({points:t},e,n=y)=>Fr(e,t[0],t[1],t[2],n)});so.isa("sphere","circle");var ue=b(A);ue.addAll({group:({children:t,attribs:e},n)=>{n=Fn(n);let s=[];for(let r of t){let i=ue(r,n);i&&s.push(i)}return new ze(Object.assign({},e),s)},line:(t,e)=>{let n=$l(t.points[0],t.points[1],Fn(e));return n&&n.length?new st(n[0],m(t)):void 0},poly:(t,e)=>{e=Fn(e);let n=Ee(t.points,e,Lt(e));return n.length?new F(n,m(t)):void 0},rect:(t,e)=>{e=Fn(e);let n=Ee(T(t),e,Lt(e));return n.length?new F(n,m(t)):void 0}});ue.isa("circle","rect");ue.isa("ellipse","rect");ue.isa("path","rect");ue.isa("quad","poly");ue.isa("tri","poly");var Gn=b(A);Gn.addAll({aabb:(t,e,n)=>Xc(e,t.pos,te([],t.pos,t.size),n),arc:(t,e,n)=>Gc(e,t.pos,t.r,t.axis,t.start,t.end,n),circle:(t,e,n)=>Zc(e,t.pos,t.r,n),cubic:({points:t},e,n)=>cl(e,t[0],t[1],t[2],t[3],n),line:({points:t},e,n)=>se(e,t[0],t[1],n),plane:(t,e,n)=>Yc(e,t.normal,t.w,n),points:(t,e,n)=>Jc(e,t.points,n),poly:(t,e,n)=>Nn(e,t.points,!0,n),polyline:(t,e,n)=>Nn(e,t.points,!1,n),quadratic:({points:t},e,n)=>bl(e,t[0],t[1],t[2],n),rect:(t,e,n)=>Wc(e,t.pos,C([],t.pos,t.size),n)});Gn.isa("quad","poly");Gn.isa("sphere","circle");Gn.isa("tri","poly");var lu=Math.atan2,hu=(t,e=y)=>{let n=t.length;if(n<=3)return t.slice();let s=1,r,i,o,c,l,a,u=uu(t);[l,a]=t[u];let h=[];for(r=0;r<n;r++)i=t[r],h[r]={p:i,t:lu(i[1]-a,i[0]-l)};h.sort((g,w)=>g.t!==w.t?g.t-w.t:g.p[0]-w.p[0]);let f=[h[0].p];for(r=1;r<n;r++){for(i=f[s-2],o=f[s-1],c=h[r].p,l=c[0],a=c[1];s>1&&au(i[0],i[1],o[0],o[1],l,a,e)||s===1&&o[0]===l&&o[1]===a;)s--,o=i,i=f[s-2];f[s++]=c}return f.length=s,f},au=(t,e,n,s,r,i,o)=>(s-e)*(r-t)>=(n-t)*(i-e)-o,uu=t=>{let e=t.length-1,n=e,[s,r]=t[e],i,o;for(;--e>=0;)i=t[e],o=i[1],(o<r||o===r&&i[0]<s)&&(s=i[0],r=o,n=e);return n},he=b(A);he.addAll({group:t=>new F(T(t),m(t)),points:t=>new F(hu(t.points),m(t)),tri:t=>t.copy()});he.isa("circle","tri");he.isa("ellipse","tri");he.isa("poly","points");he.isa("polyline","points");he.isa("quad","points");he.isa("rect","tri");var Xs=(t,e=!1)=>xs(2,1,e?Ac(t,0,1):t),Un=b(A);Un.addAll({aabb:t=>{let[e,n,s,r,i,o,c,l]=T(t);return[[e,n],[n,s],[s,r],[r,e],[i,o],[o,c],[c,l],[l,i],[e,i],[n,o],[s,c],[r,l]]},poly:t=>Xs(t.points,!0),polyline:t=>Xs(t.points),rect:t=>Xs(T(t),!0)});Un.isa("line","polyline");Un.isa("quad","poly");Un.isa("tri","poly");var ro=b(A);ro.addAll({rect:(t,e,n=[])=>qc(null,k(n,e,t.pos),t.size)});ro.isa("aabb","rect");var io=(t,e,n=$t)=>t.map(s=>n([],e,s));var oo=(t,e,n=$t)=>t.map(s=>n([],e(s),s)),Xt=t=>(e,n)=>new t(io(e.points,n),m(e)),Zt=t=>(e,n)=>new t(oo(e.points,n),m(e));var fu=(t,e)=>io(t,e,Fi),du=(t,e)=>oo(t,e,Fi),pu=t=>(e,n)=>new t(fu(e.points,n),m(e)),mu=t=>(e,n)=>new t(du(e.points,n),m(e)),fe=b(A);fe.addAll({arc:(t,e)=>fe(Ul(t),e),cubic:Xt(Z),group:(t,e)=>t.copyTransformed(n=>fe(n,e)),line:Xt(st),path:(t,e)=>new ft([...J(n=>n.type==="m"?{type:n.type,point:$t([],e,n.point)}:{type:n.type,geo:fe(n.geo,e)},t.segments)],m(t)),points:Xt(Re),points3:pu(De),poly:Xt(F),polyline:Xt(z),quad:Xt(le),quadratic:Xt(Rt),rect:(t,e)=>fe(G(t),e),text:(t,e)=>new an($t([],e,t.pos),t.body,m(t)),tri:Xt(ve)});fe.isa("circle","arc");fe.isa("ellipse","circle");var Zs=b(A);Zs.addAll({quad:({points:t},e,n=[])=>zc(n,t[0],t[1],t[3],t[2],e[0],e[1]),rect:(t,e,n=[])=>Cc(n,t.size,e,t.pos)});Zs.isa("aabb","rect");Zs.isa("quad3","quad");var pt=b(A);pt.add(vt,t=>t);pt.addAll({arc:t=>{let e=t.start;return t.start=t.end,t.end=e,t.cw=!t.cw,t},group:t=>(t.children.forEach(pt),t),path:t=>t,points:t=>(t.points.reverse(),t),ray:t=>(t.dir=wi(null,t.dir),t)});pt.isa("cubic","points");pt.isa("line","points");pt.isa("points3","points");pt.isa("poly","points");pt.isa("polyline","points");pt.isa("quad","points");pt.isa("quadratic","points");pt.isa("tri","points");var fn=b(_l);fn.addAll({"circle-circle":(t,e)=>jl(t.pos,e.pos,t.r,e.r),"line-line":({points:t},{points:e})=>En(t[0],t[1],e[0],e[1]),"plane-plane":(t,e)=>Il(t.normal,t.w,e.normal,e.w),"ray-aabb":(t,e)=>Rl(t.pos,t.dir,e.pos,e.max()),"ray-circle":(t,e)=>Pl(t.pos,t.dir,e.pos,e.r),"ray-plane":(t,e)=>ql(t.pos,t.dir,e.normal,e.w),"ray-poly":(t,e)=>Ci(t.pos,t.dir,e.points,!0),"ray-polyline":(t,e)=>Ci(t.pos,t.dir,e.points,!1),"ray-rect":(t,e)=>zl(t.pos,t.dir,e.pos,e.max()),"rect-circle":(t,e)=>({type:Dl(t.pos,t.size,e.pos,e.r)?S.INTERSECT:S.NONE}),"rect-rect":(t,e)=>({type:vl(t.pos,t.size,e.pos,e.size)?S.INTERSECT:S.NONE})});fn.isa("ray-sphere","ray-circle");fn.isa("ray-quad","ray-poly");fn.isa("ray-tri","ray-poly");fn.isa("sphere-sphere","circle-circle");var gu=b(A);gu.addAll({circle:(t,e)=>new ke(N([],t.pos),Math.max(t.r+e,0)),line:({points:[t,e],attribs:n},s)=>{let r=vc([],t,e,s);return new le([C([],t,r),C([],e,r),Pt([],e,r),Pt([],t,r)],Object.assign({},n))},rect:(t,e)=>Gl(W(t),yi(null,jc([],t.size,e),Vt),m(t))});var Qs=b(A);Qs.addAll({arc:(t,e)=>t.pointAtTheta(sn(e,t.start,t.end)),circle:(t,e)=>di(null,[t.r,R*e],t.pos),cubic:({points:t},e)=>kn([],t[0],t[1],t[2],t[3],e),ellipse:(t,e)=>gi([],nn(R*e),t.r,t.pos),line:({points:t},e)=>us([],t[0],t[1],e),poly:(t,e)=>new nt(t.points,!0).pointAt(e),polyline:(t,e)=>new nt(t.points).pointAt(e),quadratic:({points:t},e)=>zn([],t[0],t[1],t[2],e),ray:(t,e)=>Fc([],t.pos,t.dir,e),ray3:(t,e)=>$c([],t.pos,t.dir,e),rect:(t,e)=>new nt(T(t),!0).pointAt(e)});Qs.isa("quad","poly");Qs.isa("tri","poly");var Wn=b(A);Wn.addAll({aabb:(t,e)=>Br(e,t.pos,t.size),circle:(t,e)=>zr(e,t.pos,t.r),line:(t,e)=>Tn(e,t.points[0],t.points[1]),points:({points:t},e)=>Ir(e,t),poly:(t,e)=>qt(e,t.points)>0,rect:(t,e)=>$r(e,t.pos,t.size),tri:(t,e)=>vr(e,...t.points)});Wn.isa("points3","points");Wn.isa("quad","poly");Wn.isa("sphere","circle");var $e=b(A);$e.addAll({circle:(t,e)=>G(t,e),poly:(t,e)=>new F(Rn(t.points,e,!0,!0),m(t)),polyline:(t,e)=>new z(Rn(t.points,e,!1,!0),m(t))});$e.isa("ellipse","circle");$e.isa("line","polyline");$e.isa("quad","poly");$e.isa("tri","poly");$e.isa("rect","circle");var yu=b(A);yu.addAll({path:(t,e=.1)=>{let n=[],s=t.segments,r=s.length,i,o;for(let c=0;c<r;c++){let l=s[c];l.type==="l"||l.type==="p"?(i=i?i.concat(T(l.geo)):T(l.geo),o=js(i)):i?(i.push(o),n.push({geo:new z(ks(i,e)),type:"p"}),i=null):n.push(Object.assign({},l))}return i&&(i.push(o),n.push({geo:new z(i),type:"p"})),new ft(n,m(t))},poly:(t,e=.1)=>new F(ks(t.points,e,!0),m(t)),polyline:(t,e=.1)=>new z(ks(t.points,e),m(t))});var co=(t,e,n)=>e?[...J(s=>new t(qs(s),Object.assign({},n)),e)]:void 0,lo=(t,e,n)=>{let s=E([],t,e,n);return[[t,s],[d([],s),e]]},wu=b(A);wu.addAll({arc:(t,e)=>{let n=sn(e,t.start,t.end);return[new kt(d([],t.pos),d([],t.r),t.axis,t.start,n,t.xl,t.cw,m(t)),new kt(d([],t.pos),d([],t.r),t.axis,n,t.end,t.xl,t.cw,m(t))]},cubic:({attribs:t,points:e},n)=>xi(e[0],e[1],e[2],e[3],n).map(s=>new Z(s,Object.assign({},t))),line:({attribs:t,points:e},n)=>lo(e[0],e[1],n).map(s=>new st(s,Object.assign({},t))),polyline:(t,e)=>co(z,new nt(t.points).splitAt(e),t.attribs),quadratic:({attribs:t,points:e},n)=>Mi(e[0],e[1],e[2],n).map(s=>new Rt(s,Object.assign({},t)))});var bu=b(A);bu.addAll({cubic:({points:t,attribs:e},n)=>pl(n,t[0],t[1],t[2],t[3]).map(s=>new Z(s,Object.assign({},e))),line:(t,e)=>{let n=Ye(e,t.points[0],t.points[1])||0;return lo(t.points[0],t.points[1],v(n)).map(s=>new st(s,m(t)))},polyline:(t,e)=>co(z,new nt(t.points).splitNear(e),t.attribs),quadratic:({points:t,attribs:e},n)=>Ol(n,t[0],t[1],t[2]).map(s=>new Rt(s,Object.assign({},e)))});var ao=(t,{fn:e,pre:n,size:s},r=1)=>{for(;--r>=0;){let i=t.length;t=Ae(Se(xs(s,1),ri((o,c)=>e(c,o,i))),bn(),n?n(t):t)}return t},Au=b(A);Au.addAll({poly:(t,e,n=1)=>new F(ao(t.points,e,n),m(t)),polyline:(t,e,n=1)=>new z(ao(t.points,e,n),m(t))});var Ys=b(A);Ys.addAll({circle:(t,e)=>nn(R*e+Oe),cubic:({points:t},e)=>ml([],t[0],t[1],t[2],t[3],e),line:({points:t})=>oe([],t[0],t[1]),poly:(t,e)=>new nt(t.points,!0).tangentAt(e),polyline:(t,e)=>new nt(t.points).tangentAt(e),quadratic:({points:t},e)=>Sl([],t[0],t[1],t[2],e),rect:(t,e)=>new nt(T(t),!0).tangentAt(e)});Ys.isa("quad","poly");Ys.isa("tri","poly");function Ou(...t){return Ae(ii(Ve(()=>[t[0]],(e,n)=>Ae(Cn(n),bn(),e))),ti(),je(t[1])?bc(t[1],t[2]||1):t[1])}var Su=b(A);Su.add(vt,(t,e)=>Ou(T(t),e));var de=b(A);de.addAll({arc:(t,e)=>de(dt(t),e),cubic:Zt(Z),group:(t,e)=>t.copyTransformed(n=>de(n,e)),line:Zt(st),path:(t,e)=>new ft([...J(n=>n.type==="m"?{type:n.type,point:$t([],e(n.point),n.point)}:{type:n.type,geo:de(n.geo,e)},t.segments)],m(t)),points:Zt(Re),points3:mu(De),poly:Zt(F),polyline:Zt(z),quad:Zt(le),quadratic:Zt(Rt),rect:(t,e)=>de(G(t),e),tri:Zt(ve)});de.isa("circle","rect");de.isa("ellipse","circle");var Nu=b(A);Nu.addAll({aabb:(t,e)=>[new Ce(...Us(t.pos,t.size,e.pos,e.size))],rect:(t,e)=>[new rt(...Us(t.pos,t.size,e.pos,e.size))]});var uo=b(A);uo.add(vt,()=>0);uo.addAll({aabb:({size:t})=>t[0]*t[1]*t[2],sphere:t=>4/3*K*t.r**3});var Tu=(t,e)=>t===e?0:t==null?e==null?0:-1:e==null?t==null?0:1:typeof t.compare=="function"?t.compare(e):typeof e.compare=="function"?-e.compare(t):t<e?-1:t>e?1:0,pe=class{constructor(e,n){n=Object.assign({compare:Tu,equiv:at},n),this.compare=n.compare,this.equiv=n.equiv,this.values=[],e&&this.into(e)}static parentIndex(e){return e>0?e-1>>1:-1}static childIndex(e){return e>=0?(e<<1)+1:-1}*[Symbol.iterator](){yield*this.min()}get length(){return this.values.length}copy(){let e=this.empty();return e.values=this.values.slice(),e}clear(){this.values.length=0}empty(){return new pe(null,{compare:this.compare})}peek(){return this.values[0]}push(e){return this.values.push(e),this.percolateUp(this.values.length-1),this}pop(){let e=this.values,n=e.pop(),s;return e.length>0?(s=e[0],e[0]=n,this.percolateDown(0)):s=n,s}pushPop(e,n=this.values){let s=n[0];return n.length>0&&this.compare(s,e)<=0&&(n[0]=e,e=s,this.percolateDown(0,n)),e}into(e){for(let n of e)this.push(n);return this}pushPopAll(e){let n;for(let s of e)n=this.pushPop(s);return n}replaceHead(e){let n=this.values[0];return this.values[0]=e,this.percolateDown(0),n}remove(e){let{values:n,equiv:s}=this;for(let r=n.length;--r>=0;)if(s(n[r],e))return this.values.splice(r,1),this.heapify(),!0;return!1}find(e){let{values:n,equiv:s}=this;for(let r=n.length;--r>=0;)if(s(n[r],e))return n[r]}findWith(e){let n=this.values;for(let s=n.length;--s>=0;)if(e(n[s]))return n[s]}has(e){return this.find(e)!==void 0}heapify(e=this.values){for(let n=e.length-1>>1;n>=0;n--)this.percolateDown(n,e)}max(e=this.values.length){let{compare:n,values:s}=this,r=s.slice(0,e);if(!e)return r;this.heapify(r);for(let i=s.length;e<i;e++)this.pushPop(s[e],r);return r.sort((i,o)=>n(o,i))}min(e=this.values.length){let{compare:n,values:s}=this,r=s.slice(0,e).sort(n);if(!e)return r;let i=r[e-1],o;for(let c=e,l=s.length;c<l;c++)o=s[c],n(o,i)<0&&(r.splice(Eu(o,r,0,e,n),0,o),r.pop(),i=r[e-1]);return r}parent(e){return e=pe.parentIndex(e),e>=0?this.values[e]:void 0}children(e){e=pe.childIndex(e);let n=this.values,s=n.length;if(!(e>=s))return e===s-1?[n[e]]:[n[e],n[e+1]]}leaves(){let e=this.values;return e.length?e.slice(pe.parentIndex(e.length-1)+1):[]}percolateUp(e,n=this.values){let s=n[e],r=this.compare;for(;e>0;){let i=e-1>>1,o=n[i];if(r(s,o)>=0)break;n[i]=s,n[e]=o,e=i}}percolateDown(e,n=this.values){let s=n.length,r=n[e],i=this.compare,o=(e<<1)+1;for(;o<s;){let c=o+1;if(c<s&&i(n[o],n[c])>=0&&(o=c),i(n[o],r)<0)n[e]=n[o];else break;e=o,o=(e<<1)+1}n[e]=r}},Eu=(t,e,n,s,r)=>{let i;for(;n<s;)i=n+s>>>1,r(t,e[i])<0?s=i:n=i+1;return n},ho=(t,e)=>e[0]-t[0],ju=(t,e,n)=>{for(let s=e.sort(ho).length;--s>=0;){let r=e[s][1];r&&n.push(t(r))}return n},xu=(t,e,n)=>{let s=!0;for(let r of e)s=t.set(r[0],r[1],n)&&s;return s},dn=class{constructor(e,n,s,r){this.parent=e,this.d=n,this.k=s,this.v=r}get height(){return 1+Math.max(this.l?this.l.height:0,this.r?this.r.height:0)}},pn=class{constructor(e,n){this.dim=e,this._size=0,this.root=n?this.buildTree(Mn(n),0):void 0}*[Symbol.iterator](){let e=this.root?[this.root]:[];for(;e.length;){let n=e.pop();n&&(yield[n.k,n.v],e.push(n.r,n.l))}}*keys(){let e=this.root?[this.root]:[];for(;e.length;){let n=e.pop();n&&(yield n.k,e.push(n.r,n.l))}}values(){return J(e=>e[1],this)}get size(){return this._size}get height(){return this.root?this.root.height:0}get ratio(){return this._size?this.height/Math.log2(this._size):0}copy(){return new pn(this.dim,this)}clear(){delete this.root,this._size=0}empty(){return new pn(this.dim)}set(e,n,s=y){s=Math.max(0,s),s*=s;let r=(o,c)=>o?r(e[o.d]<o.k[o.d]?o.l:o.r,o):c,i;if(this.root){if(i=Be(e,[s,void 0],this.dim,this.root)[1],i)return i.v=n,!1;i=r(this.root,void 0);let o=i.d;i[e[o]<i.k[o]?"l":"r"]=new dn(i,(o+1)%this.dim,e,n)}else this.root=new dn(void 0,0,e,n);return this._size++,!0}into(e,n=y){return xu(this,e,n)}remove(e){let n=fo(e,this.root,0);return n?(Js(n)&&(this.root=void 0),this._size--,!0):!1}has(e,n=y){return!!this.root&&!!Be(e,[n*n,void 0],this.dim,this.root)[1]}get(e,n=y){if(this.root){let s=Be(e,[n*n,void 0],this.dim,this.root)[1];return s?s.v:void 0}}query(e,n,s,r){return this.doSelect(e,i=>[i.k,i.v],n,s,r)}queryKeys(e,n,s,r){return this.doSelect(e,i=>i.k,n,s,r)}queryValues(e,n,s,r){return this.doSelect(e,i=>i.v,n,s,r)}doSelect(e,n,s,r=1,i=[]){if(!this.root)return[];if(s*=s,r===1){let o=Be(e,[s,void 0],this.dim,this.root)[1];o&&i.push(n(o))}else{let o=new pe([[s,void 0]],{compare:ho});return Ks(e,o,this.dim,r,this.root),ju(n,o.values,i)}return i}buildTree(e,n,s){let r=e.length;if(r===0)return;this._size++;let i=n%this.dim;if(r===1)return new dn(s,i,...e[0]);e.sort((l,a)=>l[0][i]-a[0][i]);let o=r>>>1,c=new dn(s,i,...e[o]);return c.l=this.buildTree(e.slice(0,o),n+1,c),c.r=this.buildTree(e.slice(o+1),n+1,c),c}},fo=(t,e,n)=>{if(!!e)return j(t,e.k)<=n?e:fo(t,t[e.d]<e.k[e.d]?e.l:e.r,n)},mn=(t,e)=>{if(!t)return;if(t.d===e)return t.l?mn(t.l,e):t;let n=t.k[e],s=mn(t.l,e),r=mn(t.r,e),i=t;return s&&s.k[e]<n&&(i=s),r&&r.k[e]<i.k[e]&&(i=r),i},Js=t=>{if(!t.l&&!t.r){if(!t.parent)return!0;let s=t.parent,r=s.d;s[t.k[r]<s.k[r]?"l":"r"]=void 0;return}let e,n;t.r?(e=mn(t.r,t.d),n=e.k,Js(e),t.k=n):(e=mn(t.l,t.d),n=e.k,Js(e),t.r=t.l,t.l=void 0,t.k=n)},Ks=(t,e,n,s,r)=>{let i=r.k,o=j(i,t);if(!r.l&&!r.r){mo(e,s,r,o);return}let c=go(r,n,t,i),l=po(r,t);Ks(t,e,n,s,l),mo(e,s,r,o),c<e.values[0][0]&&(l=l===r.l?r.r:r.l,l&&Ks(t,e,n,s,l))},Be=(t,e,n,s)=>{let r=s.k,i=j(r,t);if(!s.l&&!s.r)return yo(e,s,i),e;let o=go(s,n,t,r),c=po(s,t);return Be(t,e,n,c),yo(e,s,i),o<e[0]&&(c=c===s.l?s.r:s.l,c&&Be(t,e,n,c)),e},po=(t,e)=>{let n=t.d;return t.r?t.l&&e[n]<t.k[n]?t.l:t.r:t.l},mo=(t,e,n,s)=>(!t.length||s<t.peek()[0])&&(t.length>=e?t.pushPop([s,n]):t.push([s,n])),yo=(t,e,n)=>n<t[0]&&(t[0]=n,t[1]=e),wo=[],go=(t,e,n,s)=>{for(let r=e,i=t.d;--r>=0;)wo[r]=r===i?n[r]:s[r];return j(wo,s)},He=class{constructor(e,n){this.tree=new pn(e),n&&this.into(n)}[Symbol.iterator](){return this.tree.keys()}keys(){return this.tree.keys()}values(){return this.tree.keys()}get size(){return this.tree.size}get height(){return this.tree.height}get ratio(){return this.tree.ratio}copy(){return new He(this.tree.dim,this)}clear(){this.tree.clear()}empty(){return new He(this.tree.dim)}add(e,n){return this.tree.set(e,e,n)}into(e,n){let s=!0;for(let r of e)s=this.tree.set(r,r,n)&&s;return s}remove(e){return this.tree.remove(e)}has(e,n){return this.tree.has(e,n)}get(e,n){return this.tree.get(e,n)}query(e,n,s,r){return this.tree.query(e,n,s,r)}queryKeys(e,n,s,r){return this.tree.queryKeys(e,n,s,r)}queryValues(e,n,s,r){return this.tree.queryKeys(e,n,s,r)}};var Mu=(t,e,n=1,s=re)=>_(t,e,Ur(new Array(e.length),n,s)),bo=t=>{let e=Object.assign({rnd:re,iter:1,jitter:1,quality:500},t),{points:n,index:s,rnd:r,jitter:i,quality:o,density:c}=e,l=H(c)?()=>c:c,a=Math.max(e.iter,1),u=[],h=0,f,g,w;t:for(let O=e.max;O>0;){for(f=n(r),g=l(f),w=a;w-- >0;){if(!s.has(f,g)){s.add(f,0),u.push(f),h=0,O--;continue t}Mu(null,f,i,r)}if(++h>o)break}return u};function Iu(t){let e=new He(2),n=["#FFF","#F00","#00F","#28975A","#1D6F42","#175733","#103D24"],s=t.clientHeight,r=t.clientWidth,i=bo({index:e,points:()=>As(null,[-r*.1,-s*.1],[r*1.1,s*1.1]),density:40,iter:2,max:r*s/2e3,quality:500}),o=(l,a,u)=>{let h=new ys(l),f=[[0,0],[0,u],[a,u],[a,0]];return h.delaunay(f).map(w=>vi(w))},c=to(eo({viewBox:`0 0 ${r} ${s}`,preserveAspectRatio:"xMidYMid slice",fill:"none",stroke:"blue",style:`background-color: ${n[5]}`},Ii({id:"delaunay",stroke:n[4],"stroke-width":.5},o(i,r,s))));t.innerHTML=c}export{Iu as triangulation};
//# sourceMappingURL=triangulation.js.map
